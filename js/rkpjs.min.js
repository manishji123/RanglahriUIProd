const ACCORDIAN_ICON_CLASS="accordian-icon";class AccordianTagsProperties{constructor(a,t,e){return this.defaultProp=a,this.expandProp=t,this.collapseProp=e,this}}class AccordianTags{constructor(a,t){return this.mainTag=a,this.iconTag=t,this}}class TagProperties{constructor(a,t,e){return this.classList=a,this.styleMap=t,this.innerHtml=e,this}}const accordianProperties=new Map;function initializeAccordians(a,t){var e,i=document.getElementById(a).getElementsByClassName("rkp-accordion");for(e=0;e<i.length;e++)buildAccordianTag(i[e],t),i[e].addEventListener("click",function(){toggleAccordian(this)});var r=document.getElementById(a).getElementsByClassName("rkp-accordion-all");for(e=0;e<r.length;e++){r[e].setAttribute("currentState","collapse");var n=buildTag("span",new Map([["class",ACCORDIAN_ICON_CLASS]]),r[e]);updateAccordianProperties(r[e],n,getAccordianProperties(t).collapseProp),r[e].addEventListener("click",function(){toggleAll(t,this,n,i)})}}function getAccordianProperties(a){return accordianProperties.get(a)}function updateTagProperties(a,t){if(t&&a){if(t.classList&&(a.className+=" "+t.classList),t.styleMap)for(var[e,i]of t.styleMap)a.style[e]=i;t.innerHtml&&(a.innerHTML=t.innerHtml)}}function updateAccordianProperties(a,t,e){updateTagProperties(a,e.mainTag),updateTagProperties(t,e.iconTag)}function toggleAll(a,t,e,i){var r=t.getAttribute("currentState");if(r&&"collapse"===r){for(updateAccordianProperties(t,e,getAccordianProperties(a).expandProp),n=0;n<i.length;n++)expandAccordian(i[n]);t.setAttribute("currentState","expand")}else{var n;for(updateAccordianProperties(t,e,getAccordianProperties(a).collapseProp),n=0;n<i.length;n++)collapseAccordian(i[n]);t.setAttribute("currentState","collapse")}}function buildAccordianTag(a,t){a.setAttribute("sourcePage",t),updateAccordianProperties(a,buildTag("span",new Map([["class",ACCORDIAN_ICON_CLASS]]),a),getAccordianProperties(t).defaultProp);var e=document.getElementById(a.getAttribute("target-id"));e.style.overflow="hidden";var i=document.getElementById(e.id+"-Outer");i&&(i.classList.add("border"),i.classList.add("border-info"),i.style.overflow="hidden");var r=a.getAttribute("target-initial-display");void 0===r||"show"!==r?(collapseAccordian(a),a.setAttribute("disabled","disabled")):expandAccordian(a)}function toggleAccordian(a,t){t||(t=document.getElementById(a.getAttribute("target-id"))),"block"===t.style.display?collapseAccordian(a,t):expandAccordian(a,t)}function expandAccordianByTargetElement(a){var t='[target-id="'+a.id+'"]';expandAccordian(document.querySelector(t),a)}function expandAccordian(a,t){var e=a.getAttribute("target-id");t||(t=document.getElementById(e));var i=a.getElementsByClassName(ACCORDIAN_ICON_CLASS);updateAccordianProperties(a,i[0],getAccordianProperties(a.getAttribute("sourcePage")).expandProp),a.removeAttribute("disabled"),t.style.display="block"}function collapseAccordianByTargetElement(a){var t='[target-id="'+a.id+'"]';collapseAccordian(document.querySelector(t),a)}function collapseAccordian(a,t){t||(t=document.getElementById(a.getAttribute("target-id")));var e=a.getElementsByClassName(ACCORDIAN_ICON_CLASS);updateAccordianProperties(a,e[0],getAccordianProperties(a.getAttribute("sourcePage")).collapseProp),t.style.display="none"}accordianProperties.set("chart-page",new AccordianTagsProperties(new AccordianTags(new TagProperties("rkp-chart-accordion"),new TagProperties("float-left px-3",void 0,"")),new AccordianTags(new TagProperties(void 0,new Map([["backgroundColor","LightCyan"]])),new TagProperties(void 0,new Map([["color","blue"]]),"▼")),new AccordianTags(new TagProperties(void 0,new Map([["backgroundColor","Lavender"]])),new TagProperties(void 0,new Map([["color","black"]]),"►")))),accordianProperties.set("rkp-tutorial",new AccordianTagsProperties(new AccordianTags(new TagProperties(void 0),new TagProperties(void 0,void 0,"")),new AccordianTags(new TagProperties(void 0,void 0),new TagProperties(void 0,new Map([["color","black"]]),'<i class="fas fa-minus-square"></i>')),new AccordianTags(new TagProperties(void 0,void 0),new TagProperties(void 0,new Map([["color","black"]]),'<i class="fas fa-plus-square"></i>')))),function(){"use strict";function a(a,t){t.hashPrefix(""),a.when("/rkp-home",{templateUrl:"partials/rkp-home.html"}).when("/rkp-chart",{templateUrl:"partials/rkp-chart.html",controller:"CtrlRkpChart"}).when("/rkp-contact-us",{templateUrl:"partials/rkp-contact-us.html"}).otherwise({redirectTo:"/rkp-home"})}angular.module("rkpApp",["ngRoute","rkpServiceModule","rkpControllerModule","rkpDirectiveModule"]).config(a),a.$inject=["$routeProvider","$locationProvider"]}();const basicDetailColumns=[];function buildBasicDetailDiv(a,t,e,i){for(var r=buildTag("div",new Map([["class","w-100 h-100 px-0 py-0 text-nowrap overflow-auto"]]),i),n=a.basicPanchangDetail,s=n.length,l=buildTag("tabe",new Map([["class","table-sm w-100 h-100","m-0","p-0"]]),r),o=0;o<s;o+=4){var d="border-bottom border-left border-right";0==o&&(d="border-top "+d),d="";for(var u=buildTag("tr",new Map([["class",d+" d-flex"]]),l),c=0;c<4&&s>o+c;c++){var h=n[o+c];buildTag("td",new Map([["class","border-0 text-right col-1"]]),u,"<strong>"+h.x+":</strong>");"",buildTag("td",new Map([["class"," text-left col-2"]]),u,h.y)}}return i?e(i)(t):i=r,i}function BirthChartRotartion(a){return this.ascCusp=a,this}function getCuspArray(){for(var a=[],t=1;t<=12;t++)a.push(t);return a}BirthChartRotartion.cuspArray=getCuspArray(),BirthChartRotartion.getNewMappedCuspsAfterRotation=function(a,t){var e=t-a;return e<0&&(e+=12),new Map(BirthChartRotartion.cuspArray.map(a=>[a+e>12?(a+e)%12:a+e,a]))},BirthChartRotartion.prototype.rotateChartData=function(a,t){return this.mappedCuspsAfterRotation=BirthChartRotartion.getNewMappedCuspsAfterRotation(this.ascCusp,t),a.cuspViewModals.map(a=>this.mapCuspViewModalWithNewCusp(a)),a.cuspViewModals.sort((a,t)=>a.cuspNum>t.cuspNum?1:-1),a.planets.map(a=>this.mapPlanetWithNewCusp(a)),this.ascCusp=t,this.mappedCuspsAfterRotation=null,a},BirthChartRotartion.prototype.mapPlanetWithNewCusp=function(a){return a.occCusp=this.getNewCusp(a.occCusp),a.d1Rasi=this.getNewCusp(a.d1Rasi),a.d1Nak=this.getNewCusp(a.d1Nak),a.d1Sub=this.getNewCusp(a.d1Sub),a.d1SSub=this.getNewCusp(a.d1SSub),a},BirthChartRotartion.prototype.mapCuspViewModalWithNewCusp=function(a){return a.cuspNum=this.getNewCusp(a.cuspNum),a},BirthChartRotartion.prototype.getNewCusp=function(a){if(a)return Array.isArray(a)?a.map(a=>this.mappedCuspsAfterRotation.get(a)):this.mappedCuspsAfterRotation.get(a)};class ChartDataDisplayCalculation{constructor(a,t,e){this.scope=a,this.ServiceRkpChart=t,this.compile=e,this.initialData(),this.chartDrawer=new ChartDrawer(400,250,a,e),this.chartFileOperation=new ChartFileOperation(a,t,e,this)}initialData(){var a=initialDataForChart;this.ServiceRkpChart.ayanamsas=a.ayanamsas,this.scope.ayanamsas=this.ServiceRkpChart.ayanamsas,this.ServiceRkpChart.countries=a.countries,this.scope.countries=this.ServiceRkpChart.countries;var t=a.states;this.scope.statesCountryMap=new Map,this.scope.statesCountryMap.set("IN",t),this.scope.birthChartFormFieldsstates=t,this.scope.transitstates=t,this.scope.rasiArray=rasiArray}loadStates(a){var t=this.scope[a].country;if(t){this.scope.statesCountryMap||(this.scope.statesCountryMap=new Map);var e=this.scope.statesCountryMap.get(t);if(void 0===e){var i=this.ServiceRkpChart.fetchPlaceList(t);let r=this;i.then(function(i){e=i.data,r.scope.statesCountryMap.set(t,e),r.scope[a+"states"]=e,e&&(r.scope[a].state=e[0].x)}),this.removeUnusedStates()}else this.scope[a+"states"]=e,e&&(this.scope[a].state=e[0].x);this.scope[a+"cities"]=null}}removeUnusedStates(){var a=this.scope.statesCountryMap.keys(),t=[];this.scope.birthChartFormFields&&this.scope.birthChartFormFields.country&&t.push(this.scope.birthChartFormFields.country),this.scope.transit&&this.scope.transit.country&&t.push(this.scope.transit.country);for(let e of a)t.includes(e)||this.scope.statesCountryMap.delete(e)}searchCities(a){if(!this.validateCreateChartFormData(a,this.scope[a].citySearch,["citySearch"]))return;var t=this.ServiceRkpChart.searchCities(this.scope[a].citySearch,this.scope[a].country,this.scope[a].state);let e=this;t.then(function(t){t.status>=200&&t.status<=299?(e.scope[a+"cities"]=t.data,t.data&&(e.scope[a].city=t.data[0],e.setGeoBySelectedCity(a))):e.displayBirthChartError("birthChartFormFields",t,["citySearch"])})}setGeoBySelectedCity(a){var t=this.scope[a].city;if(t){var e=convertToDMS({longitude:t.y[1],latitude:t.y[0]});this.setGeoInForm(a,e.longitude,e.latitude,t.y[2])}}initBirthChartParameter(){buildChartform(document.getElementById("birthChartFormFieldsDiv"),this.scope,this.compile,"birthChartFormFields","createRangahriChart()"),this.scope.birthChartFormFields||(this.scope.birthChartFormFields={},this.setDateAndTimeInForm("birthChartFormFields"),this.setOtherParameterInBirthChartForm("birthChartFormFields","","birth",generateRandomInteger(1,249)),this.scope.birthChartFormFields.ayanamsa=this.ServiceRkpChart.defaultAyanamsa,this.scope.birthChartFormFields.country=this.ServiceRkpChart.defaultCountry,this.scope.birthChartFormFields.state=this.ServiceRkpChart.defaultState,this.scope.birthChartFormFields.isBhavaMadhya=!1,this.scope.birthChartFormFields.isPlacidous=!0)}initTransitParameter(){buildChartform(document.getElementById("transitFormFields"),this.scope,this.compile,"transit","getNativeTransit()"),this.scope.transit||(this.scope.transit={},this.setDateAndTimeInForm("transit"),this.scope.transit.ayanamsa=this.ServiceRkpChart.defaultAyanamsa,this.scope.transit.country=this.ServiceRkpChart.defaultCountry,this.scope.transit.state=this.ServiceRkpChart.defaultState),this.hideTransitformAyamansa()}setOtherParameterInBirthChartForm(a,t,e,i){t&&(t=t.replace(".rkp",""));var r=!(!e||"horary"!==e);document.getElementById(a+"nameInput").value=t,r?(document.getElementById(a+"birthChartRadio").getchecked=!1,document.getElementById(a+"horaryChartRadio").checked=!0):(document.getElementById(a+"birthChartRadio").checked=!0,document.getElementById(a+"horaryChartRadio").checked=!1),document.getElementById(a+"horaryNumberInput").value=i,this.scope[a].name=t,this.scope[a].isHorayChart=r,this.scope[a].horaryNumber=i}setLocalGeoInForm(a){var t=getLocalLocationPositionPromise();let e=this;return t.then(function(t){var i=convertToDMS(t.coords);e.setGeoInForm(a,i.longitude,i.latitude)}),this.setTimeZoneInForm(a),t}setTimeZoneInForm(a){var t=getTimeZoneHour(new Date);this.scope[a].timezone=t,document.getElementById(a+"timezoneInput").value=t}setGeoInForm(a,t,e,i){this.scope[a].longitude=t,this.scope[a].latitude=e,document.getElementById(a+"longitudeInput").value=t,document.getElementById(a+"latitudeInput").value=e,i&&(this.scope[a].timezone=i,document.getElementById(a+"timezoneInput").value=i)}setDateAndTimeInForm(a,t){t||(t=new Date).setMilliseconds(0),document.getElementById(a+"dateInput").value=t,this.scope[a].date=t instanceof Date?t:new Date(t)}setBirthChartParameterFromFile(a){this.chartFileOperation.setBirthChartParameterFromFile(a)}saveBirthChartFile(){this.chartFileOperation.saveBirthChartFile()}hideTransitformAyamansa(){var a=this.ServiceRkpChart.getCachedChartData();if(a){var t=document.getElementById("transitayanamsaDiv");t&&(t.style.display="none",this.scope.transit.ayanamsa=a.nativeBirthDetail.ayanamsa)}}createMomentChart(){var a="birthChartFormFields",t=getLocalLocationPositionPromise(),e=new Date;e.setMilliseconds(0),this.scope[a].date=e,this.scope[a].name=formatDate(e),this.scope[a].timezone=getTimeZoneHour(e);let i=this;t.then(function(t){var e=convertToDMS(t.coords);i.setGeoInForm(a,e.longitude,e.latitude),i.createBirthChart()})}createBirthChart(){if(!this.validateCreateChartFormData("birthChartFormFields",this.scope.birthChartFormFields))return;var a={longitude:this.scope.birthChartFormFields.longitude,latitude:this.scope.birthChartFormFields.latitude,timezone:this.scope.birthChartFormFields.timezone,date:formatDate(this.scope.birthChartFormFields.date),name:this.scope.birthChartFormFields.name,chartType:this.scope.birthChartFormFields.isHorayChart?"horary":"birth",horaryNumber:this.scope.birthChartFormFields.isHorayChart?this.scope.birthChartFormFields.horaryNumber:null,ayanamsa:this.scope.birthChartFormFields.ayanamsa,placidous:this.scope.birthChartFormFields.isPlacidous,bhavaMadhya:this.scope.birthChartFormFields.isBhavaMadhya},t=this.ServiceRkpChart.creatNewChart(a);let e=this;t.then(function(a){a.status>=200&&a.status<=299?e.displayBirthChart(a.data):e.displayBirthChartError("birthChartFormFields",a)})}createChartForTransitDiv(a,t){var e,i;if(a)i=new Date(t||this.scope.dasaTransitDT);else{if(!this.validateCreateChartFormData("transit",this.scope.transit))return;i=this.scope.transit.date,e=this.scope.transit}e=this.buildTransitRequestData(i,e),this.clearTransitData();var r=this.ServiceRkpChart.creatNewChart(e);let n=this;r.then(function(t){t.status>=200&&t.status<=299?(n.ServiceRkpChart.setTransitData(t.data),n.clearTransitData(),n.fillTransitDiv(),a&&(n.scope.transit.date=i,n.scope.transit.timezone=e.timezone,n.scope.transit.longitude=e.longitude,n.scope.transit.latitude=e.latitude),n.scope.transit.dateToDisplay=formatDate(i)):n.displayBirthChartError("transit",t)})}validateCreateChartFormData(a,t,e){return BirthChartValidation.validateAndDisplayMessage(a,t,e)}displayBirthChart(a){this.ServiceRkpChart.setChartData(a),this.clearHoroscopeData(),this.fillHoroscopeData()}displayBirthChartError(a,t,e){if(422==t.status){var i=t.data.fieldErrors;BirthChartValidation.displayErrorMessages(a,i,e)}else t.status=400}buildTransitRequestData(a,t){var e,i,r=this.ServiceRkpChart.getCachedChartData();if(a&&(t||r))return r&&(e=r.cuspViewModals.map(function(a){return a.startDegree360}),t||(t=r.nativeBirthDetail),i=r.nativeBirthDetail.bhavaMadhya),{longitude:t.longitude,latitude:t.latitude,timezone:t.timezone,date:formatDate(a),name:"transit",chartType:"transit",ayanamsa:t.ayanamsa,cuspDegrees:e,bhavaMadhya:i}}fillHoroscopeData(){var a=document.getElementById("birthChartFormDiv");this.ServiceRkpChart.getCachedChartData()?(this.fillBasicBirthChartDetailDiv(),this.fillCompleteChartRotationDiv(),this.fillBirthChartDiv(),this.fillDivisionalChartDiv(),this.fillDasaDiv(),collapseAccordianByTargetElement(a),this.hideTransitformAyamansa()):expandAccordianByTargetElement(a)}fillBasicBirthChartDetailDiv(){var a=document.getElementById("birthChartPanchangDetailDiv");buildBasicDetailDiv(this.ServiceRkpChart.getCachedChartData(),this.scope,this.compile,a)}clearBasicBirthChartDetailDiv(){document.getElementById("birthChartPanchangDetailDiv").innerHTML=""}fillCompleteChartRotationDiv(){this.ServiceRkpChart.birthChartRotartion=new BirthChartRotartion(1),this.scope.cuspArray=BirthChartRotartion.cuspArray,this.scope.birthChartAscCusp=this.ServiceRkpChart.birthChartRotartion.ascCusp,buildChartRoationDiv(document.getElementById("birthChartRotationDiv"),this.scope,this.compile,"birthChart")}fillDivisionalChartDiv(){var a=this.ServiceRkpChart.getCachedChartData();if(a){var t=document.getElementById("divisional_charts");if(expandAccordianByTargetElement(t),1!=a.divisionalCharts[0].chartType){var e={chartType:1};e.ascendentRasi=a.cuspViewModals[0].cuspRisingRasi,e.rasiPlanets=groupByWithValue(a.planets,"rasiNum","abbr"),a.divisionalCharts.unshift(e)}this.chartDrawer.buildDivisionalCharts(t,a)}}fillDasaDiv(){var a=this.ServiceRkpChart.getCachedChartData();if(a){var t=a.nativeBirthDetail.date;expandAccordianByTargetElement(document.getElementById("naisargikDasaDiv")),buildNaisargikHouseDasaTabulator(document.getElementById("housedasas_data"),t),buildNaisargikStartRasiSelect(document.getElementById("rasidasas_data"),this.scope,this.compile),this.scope.naisargikStartRasiModel=a.cuspViewModals[0].cuspRisingRasi,buildNaisargikRasiDasaTabulator(document.getElementById("rasidasas_data"),t),expandAccordianByTargetElement(document.getElementById("birthChartDasa"));var e=a.planets.slice(0,9);buildMahaDasaTabulator(document.getElementById("mahadasas_data"),e);var i=buildNaisargikDasaPlanetSequence(e,a.cuspViewModals);a.naisargikPlanets=i,buildNaisargikMahaDasaTabulator(document.getElementById("naisargikPlanetdasas_data"),i,t)}}fillTransitDiv(){var a=this.ServiceRkpChart.getCachedChartData(),t=this.ServiceRkpChart.getCachedTransitData(),e=document.getElementById("transitChartFormDiv");if(t){expandAccordianByTargetElement(document.getElementById("transitChart"));var i=document.getElementById("transit_data");if(expandAccordianByTargetElement(i),a){var r=buildTag("div",void 0,i),n={};n.planets=t.planets,n.cuspViewModals=a.cuspViewModals;var s={chartType:9};s.ascendentRasi=a.cuspViewModals[0].navamsa,s.rasiPlanets=groupByWithValue(t.planets,"navamsa","abbr"),this.chartDrawer.buildTransitCharts(r,n,s)}var l=buildTag("div",void 0,i);if(this.fillTransitPlanetDiv(l,t),a)buildTransitDestinyMatrixTable(buildTag("div",void 0,i),a.planets,t.planets);collapseAccordianByTargetElement(e)}else expandAccordianByTargetElement(e)}fillBirthChartDiv(){var a=this.ServiceRkpChart.getCachedChartData();if(a){this.scope.horoscopeCreated=!0,expandAccordianByTargetElement(document.getElementById("rkp_charts"));var t=document.getElementById("kp_charts");expandAccordianByTargetElement(t);var e=buildTag("div",new Map([["class","overflow-auto"]]),t);this.chartDrawer.buildKPCharts(e,a);var i=document.getElementById("rkp_tables");expandAccordianByTargetElement(i);var r=buildTag("div",void 0,i);new PlanetTable(this.scope,this.ServiceRkpChart).build(r,a.planets);var n=buildTag("div",void 0,i);new CuspTable(this.scope,this.ServiceRkpChart).build(n,a.cuspViewModals);var s=document.getElementById("dmatrix_data");expandAccordianByTargetElement(s),buildDestinyMatrixTable(s,a.planets)}}fillTransitPlanetDiv(a,t){var e=new PlanetTable(this.scope,this.ServiceRkpChart).build(a,t.planets);e.hideColumn("d1Rasi"),e.hideColumn("d1Nak"),e.hideColumn("d1Sub"),e.hideColumn("d1SSub"),e.hideColumn("d2Nak"),e.hideColumn("d2Rasi")}fillTransitChartDiv(a,t){var e={};e.planets=t.planets,e.cuspViewModals=this.ServiceRkpChart.getCachedChartData().cuspViewModals;var i={chartType:9};i.ascendentRasi=e.cuspViewModals[0].navamsa,i.rasiPlanets=groupByWithValue(t.planets,"navamsa","abbr"),this.chartDrawer.buildBasicCharts(a,e,"dasaTransitChart",void 0,i)}fillDetailedInternalDasaDiv(a,t,e){if(!this.scope.currentInternalDasaStartDT||!document.getElementById("internaldasas_data-detailedDasa")||this.scope.currentInternalDasaStartDT!=t){var i=PlanetUtil.get(a),r=new Date(t).getTime(),n=new Date(r+31556952e3*(i.period-e));e&&(r-=31556952e3*e);var s=new Date(r),l={name:i.name,startDt:s,endDt:n};l.internalDasa=buildAnatardasaDasaStructure(a,s,3,i.period),document.getElementById("internaldasas_data").innerHTML="",buildDetailedDasaTable(document.getElementById("internaldasas_data"),l),this.scope.currentInternalDasaStartDT=t}}fillDetailedInternalPlanetNaisargikDasa(a,t,e){var i=new Date(t.valueOf());if(e&&i.setFullYear(i.getFullYear()+e),!this.scope.currentInternalPlanetNaisargikDasaStartDT||!document.getElementById("naisargikPlanetInternaldasas_data-detailedDasa")||this.scope.currentNaisargikPlanetInternalDasaStartDT!==i){var r=PlanetUtil.get(a),n=new Date(i.valueOf());n.setFullYear(i.getFullYear()+r.exaltationRasi);var s={name:r.name,startDate:i,endDate:n};s.internalDasa=buildNaisargikDasaStructure(a,i,3,r.exaltationRasi,this.ServiceRkpChart.chartData.naisargikPlanets),document.getElementById("naisargikPlanetInternaldasas_data").innerHTML="",buildPlanetNaisargikDetailedDasaTable(document.getElementById("naisargikPlanetInternaldasas_data"),s),this.scope.currentInternalPlanetNaisargikDasaStartDT=i}}fillDetailedInternalHouseNaisargikDasa(a,t,e){var i=new Date(t.valueOf());if(e&&i.setFullYear(i.getFullYear()+e),!this.scope.currentInternalHouseNaisargikDasaStartDT||!document.getElementById("houseinternaldasas_data-detailedDasa")||this.scope.currentInternalHouseNaisargikDasaStartDT!==i){var r=new Date(i.valueOf());r.setFullYear(i.getFullYear()+12);var n={name:a,startDate:i,endDate:r};n.internalDasa=buildNaisargikHouseDasaStructure(a,i,3);var s=document.getElementById("houseinternaldasas_data");s.innerHTML="",buildNaisargikHouseDetailedDasaTable(s,n),this.scope.currentInternalHouseNaisargikDasaStartDT=i}}fillDetailedInternalRasiNaisargikDasa(a,t){var e=new Date(a.valueOf());e.setFullYear(a.getFullYear()+24);var i={name:t,startDate:a,endDate:e},r=this.scope.naisargikStartRasiModel;i.internalDasa=buildNaisargikRasiDasaStructure(r,a,3);var n=document.getElementById("rasiInternaldasas_data");n.innerHTML="",buildNaisargikRasiDetailedDasaTable(n,i),this.scope.currentInternalRasiNaisargikDasaStartDT=a}clearHoroscopeData(){this.clearBasicBirthChartDetailDiv(),this.clearChartRotationDiv(),this.clearBirthChartDiv(),this.clearDivisionalChartDiv(),this.clearDasaDiv(),this.clearTransitData(),this.ServiceRkpChart.setTransitData(null),expandAccordianByTargetElement(document.getElementById("birthChartFormDiv"))}clearChartRotationDiv(){this.ServiceRkpChart.birthChartRotartion=null,document.getElementById("birthChartRotationDiv").innerHTML=""}clearBirthChartDiv(){var a=document.getElementById("dmatrix_data"),t=document.getElementById("kp_charts"),e=document.getElementById("rkp_tables");a.innerHTML="",t.innerHTML="",e.innerHTML="",collapseAccordianByTargetElement(a),collapseAccordianByTargetElement(t),collapseAccordianByTargetElement(e),collapseAccordianByTargetElement(document.getElementById("rkp_charts"))}clearDivisionalChartDiv(){var a=document.getElementById("divisional_charts");a.innerHTML="",collapseAccordianByTargetElement(a)}clearDasaDiv(){document.getElementById("mahadasas_data").innerHTML="",document.getElementById("internaldasas_data").innerHTML="",document.getElementById("naisargikPlanetdasas_data").innerHTML="",document.getElementById("naisargikPlanetInternaldasas_data").innerHTML="",document.getElementById("housedasas_data").innerHTML="",document.getElementById("houseinternaldasas_data").innerHTML="",document.getElementById("rasidasas_data").innerHTML="",document.getElementById("rasiInternaldasas_data").innerHTML="",collapseAccordianByTargetElement(document.getElementById("birthChartDasa"))}clearTransitData(){var a=document.getElementById("transit_data");collapseAccordianByTargetElement(a),a.innerHTML="",expandAccordianByTargetElement(document.getElementById("transitChartFormDiv"))}resetValue(a,t,e){if(a&&t)for(var i=0;i<t.length;i++)if("horaryNumber"===t[i]){var r=generateRandomInteger(1,249);document.getElementById(a+"horaryNumberInput").value=r,this.scope[a].horaryNumber=r}else"geoCordinates"===t[i]?this.setLocalGeoInForm(a):"dateTime"===t[i]?this.setDateAndTimeInForm(a):"isBhavaMadhya"===t[i]&&(this.scope[a].isBhavaMadhya="placidousChartRadio"!==e)}checkBhavaMadhya(a,t){}birthChartRotate(){this.ServiceRkpChart.birthChartRotartion.ascCusp!==this.scope.birthChartAscCusp&&(this.ServiceRkpChart.birthChartRotartion.rotateChartData(this.ServiceRkpChart.getCachedChartData(),this.scope.birthChartAscCusp),this.clearBirthChartDiv(),this.clearTransitData(),this.ServiceRkpChart.setTransitData(null),this.fillBirthChartDiv(),collapseAccordianByTargetElement(document.getElementById("divisional_charts")),console.log(this.scope.birthChartAscCusp))}rotateIndividualChart(a,t,e){var i=this.ServiceRkpChart.getCachedChartData();"divisional"==a&&(i=findByValue(i.divisionalCharts,"chartType",e)),this.chartDrawer.rotateIndividualChart(a,t,i,e)}}class ChartFileOperation{constructor(a,t,e,i){this.scope=a,this.ServiceRkpChart=t,this.compile=e,this.chartDataDisplayCalculation=i}setBirthChartParameterFromFile(a){var t=a.name;t.endsWith(".jhd")?this.setBirthChartParameterFromJHDFile(a,t):t.endsWith(".rkp")&&this.setBirthChartParameterFromRKPFile(a,t)}setBirthChartParameterFromRKPFile(a,t){if(this.scope.birthParametersFile=a,this.scope.birthChartFormFields||(this.scope.birthChartFormFields={}),a){var e=new FileReader;e.readAsText(a,"UTF-8");let i=this;e.onload=function(a){const e=a.target.result.split(/\r\n|\n/);i.chartDataDisplayCalculation.setGeoInForm("birthChartFormFields",e[2],e[3],e[1]),i.chartDataDisplayCalculation.setDateAndTimeInForm("birthChartFormFields",e[0]),i.chartDataDisplayCalculation.setOtherParameterInBirthChartForm("birthChartFormFields",t,e[4],e[5])},e.onerror=function(a){i.scope.fileContent="error"}}}setBirthChartParameterFromJHDFile(a,t){if(this.scope.birthParametersFile=a,this.scope.birthChartFormFields||(this.scope.birthChartFormFields={}),a){var e=new FileReader;e.readAsText(a,"UTF-8");let i=this;e.onload=function(a){const e=a.target.result.split(/\r\n|\n/);i.chartDataDisplayCalculation.setGeoInForm("birthChartFormFields",-1*e[5],e[6],getTZFromJhoraParams(e[4])),i.chartDataDisplayCalculation.setDateAndTimeInForm("birthChartFormFields",getDateFromJhoraParams(e)),i.setOtherJhoraParameterInBirthChartForm("birthChartFormFields",t)},e.onerror=function(a){i.scope.fileContent="error"}}}setOtherJhoraParameterInBirthChartForm(a,t,e,i){t&&(t=t.replace(".jhd",""));var r=!(!e||"horary"!==e);document.getElementById(a+"nameInput").value=t,r?(document.getElementById(a+"birthChartRadio").getchecked=!1,document.getElementById(a+"horaryChartRadio").checked=!0):(document.getElementById(a+"birthChartRadio").checked=!0,document.getElementById(a+"horaryChartRadio").checked=!1),document.getElementById(a+"horaryNumberInput").value=i,this.scope[a].name=t,this.scope[a].isHorayChart=r,this.scope[a].horaryNumber=i}saveBirthChartFile(){this.scope.fileDownloadCheck?this.saveBirthChartJhoraFile():this.saveBirthChartRKPFile()}saveBirthChartJhoraFile(){var a=this.scope.birthChartFormFields.date,t=a.getMonth()+1;t+="\n"+a.getDate(),t+="\n"+a.getFullYear();var e=a.getHours(),i=a.getMinutes()+"",r=Math.floor(10*a.getSeconds()/6)+"";t+="\n"+e+"."+i.padStart(2,"0")+r.padStart(2,"0"),t+="\n"+-1*this.scope.birthChartFormFields.timezone,t+="\n"+-1*convertDegreeIntoDouble(this.scope.birthChartFormFields.longitude),t+="\n"+convertDegreeIntoDouble(this.scope.birthChartFormFields.latitude);var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",this.scope.birthChartFormFields.name+".jhd"),n.click()}saveBirthChartRKPFile(){var a=formatDate(this.scope.birthChartFormFields.date);a+="\n"+this.scope.birthChartFormFields.timezone,a+="\n"+this.scope.birthChartFormFields.longitude,a+="\n"+this.scope.birthChartFormFields.latitude,a+="\n"+(this.scope.birthChartFormFields.isHorayChart?"horary":"birth"),a+="\n"+this.scope.birthChartFormFields.horaryNumber;var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(a)),t.setAttribute("download",this.scope.birthChartFormFields.name+".rkp"),t.click()}}function buildChartform(a,t,e,i,r){a&&a.classList.add("pt-2");var n=buildTag("form",new Map([["class","needs-validation"]]),a),s=buildTag("div",new Map([["class","col-md-10 border py-2"]]),n);if("birthChartFormFields"===i){var l=buildTag("div",new Map([["class","form-row pb-2 m-0 px-1"]]),s),o=buildTag("div",void 0,l),d=buildTag("div",new Map([["class","form-check-inline"]]),o);buildTag("input",new Map([["id",i+"placidousChartRadio"],["type","radio"],["class","form-check-input"],["ng-click",'resetValue("'+i+'", ["isBhavaMadhya"], "placidousChartRadio")'],["ng-model",i+".isPlacidous"],["ng-value",!0]]),d),buildTag("label",new Map([["for",i+"placidousChartRadio"],["class","form-check-label"]]),d,"Placidous");var u=buildTag("div",new Map([["class","form-check-inline"]]),o);buildTag("input",new Map([["id",i+"equalHouseChartRadio"],["type","radio"],["class","form-check-input"],["ng-click",'resetValue("'+i+'", ["isBhavaMadhya"])'],["ng-model",i+".isPlacidous"],["ng-value",!1]]),u),buildTag("label",new Map([["for",i+"equalHouseChartRadio"],["class","form-check-label"]]),u,"Equal House");var c=buildTag("div",new Map([["class","form-check-inline pull-right"]]),l);buildTag("input",new Map([["id",i+"bhavaMadhyaChartCheckbox"],["type","checkbox"],["class","form-check-input"],["ng-model",i+".isBhavaMadhya"],["ng-value",!1]]),c),buildTag("label",new Map([["for",i+"bhavaMadhyaChartCheckbox"],["class","form-check-label"]]),c,"Bhava Madhya")}var h=buildTag("div",new Map([["class","form-row pb-3 m-0"]]),s),p=buildTag("div",new Map([["id",i+"ayanamsaDiv"],["class","col-md-4"]]),h);if(buildTag("label",new Map([["for",i+"ayanamsaSelect"],["class","p-0 m-0 requiredFieldLabel"]]),p,"Ayanamsa"),buildTag("select",new Map([["id",i+"ayanamsaSelect"],["ng-options","o for o in ayanamsas"],["ng-model",i+".ayanamsa"],["class","custom-select form-control"]]),p),"birthChartFormFields"===i){var m=buildTag("div",new Map([["id",i+"chartTypeDiv"],["class","col-md-4 px-3"]]),h);buildTag("legend",new Map([["class","col-form-label p-0 m-0 requiredFieldLabel"]]),m,"Chart Type");var g=buildTag("div",new Map([["class","form-check"]]),m);buildTag("input",new Map([["id",i+"birthChartRadio"],["type","radio"],["class","form-check-input"],["ng-model",i+".isHorayChart"],["ng-value",!1]]),g),buildTag("label",new Map([["for",i+"birthChartRadio"],["class","form-check-label"]]),g,"Birth Chart");var b=buildTag("div",new Map([["class","form-check"]]),m);buildTag("input",new Map([["id",i+"horaryChartRadio"],["type","radio"],["class","form-check-input"],["ng-model",i+".isHorayChart"],["ng-value",!0]]),b),buildTag("label",new Map([["for",i+"horaryChartRadio"],["class","form-check-label"]]),b,"Horary Chart");var y=buildTag("div",new Map([["ng-show",i+".isHorayChart"],["class","col-md-4"]]),h);buildTag("label",new Map([["for",i+"horaryNumberInput"],["class","p-0 m-0 requiredFieldLabel"]]),y,"Horary Number");var C=buildTag("div",new Map([["id",i+"horaryNumberGrpDiv"],["class","input-group"]]),y);buildTag("input",new Map([["type","number"],["id",i+"horaryNumberInput"],["class","form-control"],["ng-model",i+".horaryNumber"],["min","1"],["max","249"]]),C);var v=buildTag("div",new Map([["class","input-group-append"]]),C);buildTag("button",new Map([["type","submit"],["ng-click",'resetValue("'+i+'", ["horaryNumber"])'],["class","btn btn-secondary btn-sm"]]),v,"Reset")}var f=buildTag("div",new Map([["class","form-row pb-3 m-0"]]),s);if("birthChartFormFields"===i){var T=buildTag("div",new Map([["id",i+"nameGrpDiv"],["class","col-md-6"]]),f);buildTag("label",new Map([["for",i+"nameInput"],["class","p-0 m-0 requiredFieldLabel"]]),T,"Name"),buildTag("input",new Map([["type","text"],["id",i+"nameInput"],["class","form-control"],["ng-model",i+".name"],["placeholder","Enter Name"]]),T)}var D=buildTag("div",new Map([["id",i+"dateGrpDiv"],["class","col-md-6"]]),f);buildTag("label",new Map([["for",i+"DateInput"],["class","p-0 m-0 requiredFieldLabel"]]),D,"Birth Date");var w=buildTag("div",new Map([["class","input-group"]]),D);buildTag("input",new Map([["type","datetime-local"],["id",i+"dateInput"],["step","1"],["ng-model",i+".date"],["class","form-control"]]),w);var x=buildTag("div",new Map([["class","input-group-append"]]),w);buildTag("button",new Map([["type","submit"],["ng-click",'resetValue("'+i+'", ["dateTime"])'],["class","btn btn-secondary btn-sm"]]),x,"Current");var M=buildTag("div",new Map([["class","form-row pb-3 m-0"]]),s),S=buildTag("div",new Map([["class","col-md-6"]]),M);buildTag("label",new Map([["for",i+"Country"],["class","p-0 m-0"]]),S,"Country"),buildTag("select",new Map([["id",i+"Country"],["ng-options","obj.x as obj.y for obj in countries"],["ng-model",i+".country"],["ng-change",'changeStates("'+i+'")'],["class","custom-select form-control"]]),S);var k=buildTag("div",new Map([["class","col-md-6"]]),M);buildTag("label",new Map([["for",i+"State"],["class","p-0 m-0"]]),k,"State"),buildTag("select",new Map([["id",i+"State"],["ng-options","obj.x as obj.y for obj in "+i+"states"],["ng-model",i+".state"],["class","custom-select form-control"]]),k);var R=buildTag("div",new Map([["class","form-row pb-3 m-0"]]),s),A=buildTag("div",new Map([["class","col-md-6"]]),R);buildTag("label",new Map([["for",i+"citySearch"],["class","p-0 m-0"]]),A,"Search City");var B=buildTag("div",new Map([["id",i+"citySearchGrpDiv"],["class","input-group"]]),A);buildTag("input",new Map([["type","text"],["id",i+"citySearchInput"],["ng-model",i+".citySearch"],["class","form-control"],["aria-describedby",i+"GeoHelpTextBlock"]]),B),buildTag("small",new Map([["id",i+"GeoHelpTextBlock"],["class","form-text text-info m-0 p-0"]]),A,"* Search and select city to populate geo coordinates & timezone");var N=buildTag("div",new Map([["class","input-group-append"]]),B);buildTag("button",new Map([["type","submit"],["ng-click",'searchCities("'+i+'")'],["class","btn btn-secondary btn-sm"]]),N,"Search");var P=buildTag("div",new Map([["class","col-md-6"]]),R);buildTag("label",new Map([["for",i+"City"],["class","p-0 m-0"]]),P,"Select City"),buildTag("select",new Map([["id",i+"City"],["ng-options","obj as obj.x for obj in "+i+"cities"],["ng-model",i+".city"],["ng-change",'setGeoBySelectedCity("'+i+'")'],["class","custom-select form-control"]]),P);var F=buildTag("div",new Map([["class","px-0 col-md-12"]]),s);buildTag("label",new Map([["for",i+"GeoBlock"],["class","p-0 m-0"]]),F,"Geo Coordinates & Timezone");var I=buildTag("div",new Map([["for",i+"GeoBlock"],["class","border pt-2 pb-0 m-0 px-3"]]),F),E=buildTag("div",new Map([["class","form-row p-0 m-0"]]),I),L=buildTag("div",new Map([["class","form-group col-md-12 py-0 my-0"]]),E);buildTag("button",new Map([["type","submit"],["id",i+"localGeoResetButton"],["ng-click",'resetValue("'+i+'", ["geoCordinates"])'],["class","btn btn-secondary btn-sm float-right"],["data-toggle","tooltip"],["data-placement","left"],["title","* Click to set the local geo coordinates and timezone"]]),L,"Local Geo & Timezone");var H=buildTag("div",new Map([["class","form-row p-0 m-0"]]),I),V=buildTag("div",new Map([["id",i+"longitudeGrpDiv"],["class","col-md-4"]]),H);buildTag("label",new Map([["for",i+"longInput"],["class","p-0 m-0 requiredFieldLabel"]]),V,"Longitude"),buildTag("input",new Map([["type","text"],["id",i+"longitudeInput"],["ng-model",i+".longitude"],["class","form-control"]]),V);var _=buildTag("div",new Map([["id",i+"latitudeGrpDiv"],["class","form-group col-md-4"]]),H);buildTag("label",new Map([["for",i+"latiInput"],["class","p-0 m-0 requiredFieldLabel"]]),_,"Latitude"),buildTag("input",new Map([["type","text"],["id",i+"latitudeInput"],["ng-model",i+".latitude"],["class","form-control"]]),_);var G=buildTag("div",new Map([["id",i+"timezoneGrpDiv"],["class","form-group col-md-4"]]),H);buildTag("label",new Map([["for",i+"tzInput"],["class","p-0 m-0 requiredFieldLabel"]]),G,"Timezone"),buildTag("input",new Map([["type","text"],["id",i+"timezoneInput"],["ng-model",i+".timezone"],["class","form-control"]]),G);var z=buildTag("div",new Map([["class","form-row pt-2"]]),n),O=buildTag("div",new Map([["class","form-group  px-2"]]),z);return buildTag("button",new Map([["type","submit"],["ng-click",r],["class","btn btn-success btn-lg"]]),O,"Create"),e(a)(t),a}function buildChartRoationDiv(a,t,e,i){var r=buildTag("div",new Map([["class","w-100 px-2 py-1"]]),a),n=buildTag("div",new Map([["class","w-100"],["id",i+"cuspRotationDiv"]]),r),s=buildTag("div",new Map([["class","form-row form-inline px-1"]]),n);buildTag("strong",new Map([["class","pr-5 pl-2"]]),s,"Horoscope Rotation : "),buildTag("label",new Map([["for",i+"cuspRotationSelect"],["class","px-1"]]),s,"Lagna(Ascendent Cusp): "),buildTag("select",new Map([["id",i+"cuspRotationSelect"],["ng-options","n for n in cuspArray"],["ng-model",i+"AscCusp"],["class","custom-select form-control"]]),s);var l=buildTag("div",new Map([["class","form-group  px-2"]]),s);return buildTag("button",new Map([["type","submit"],["ng-click",i+"Rotate()"],["class","btn btn-secondary"]]),l,"Go"),e(a)(t),a}var contextPath="";contextPath="https://api.ranglahri.com";const defaultCountry="IN";function ConrollerHelper(a,t,e){return this.scope=a,this.ServiceRkpChart=t,this.compile=e,this}function CuspTable(a,t){return this.scope=a,this.ServiceRkpChart=t,that=this,this}function buildMahaDasaTabulator(a,t){return new Tabulator(a,{layout:"fitData",headerSort:!1,resizableColumns:!1,movableRows:!1,movableColumns:!1,data:t,autoResize:!0,height:"570",columnMinWidth:120,initialSort:[{column:"dasa.startDT",dir:"asc"}],columns:[{title:"Vimsottari Dasa",field:"dasa.startDT",formatter:function(a,t){return buildDasaButton(a.getRow().getData())}}]})}ConrollerHelper.prototype.bindChartDataDisplayCalls=function(a){this.bindBirthChartCalls(a),this.bindDasaCalls(a),this.bindTransitChartCalls(a)},ConrollerHelper.prototype.bindBirthChartCalls=function(a){a.initBirthChartParameter(),a.fillHoroscopeData(),this.scope.resetValue=function(t,e,i){a.resetValue(t,e,i)},this.scope.birthChartRotate=function(){a.birthChartRotate()},this.scope.createRangahriChart=function(){a.createBirthChart()},this.scope.createMomentChart=function(){a.createMomentChart()},this.scope.readBirthChartParametersFile=function(t){a.setBirthChartParameterFromFile(t)},this.scope.saveBirthChartFile=function(){setTimeout(function(){a.saveBirthChartFile()},500)},this.scope.changeStates=function(t){a.loadStates(t)},this.scope.searchCities=function(t){a.searchCities(t)},this.scope.setGeoBySelectedCity=function(t){a.setGeoBySelectedCity(t)},this.scope.rotateIndividualChart=function(t,e,i){a.rotateIndividualChart(t,e,i)}},ConrollerHelper.prototype.bindDasaCalls=function(a){this.scope.getDetailedInternalDasa=function(t,e,i){a.fillDetailedInternalDasaDiv(t,e,i)},this.scope.getDasaTransitData=function(t){a.createChartForTransitDiv(!0,t)},this.scope.getDetailedInternalPlanetNaisargikDasa=function(t,e,i){a.fillDetailedInternalPlanetNaisargikDasa(t,e,i)},this.scope.getDetailedInternalHouseNaisargikDasa=function(t,e,i){a.fillDetailedInternalHouseNaisargikDasa(t,e,i)},this.scope.getDetailedInternalRasiNaisargikDasa=function(t,e){a.fillDetailedInternalRasiNaisargikDasa(t,e)}},ConrollerHelper.prototype.bindTransitChartCalls=function(a){a.initTransitParameter(),a.fillTransitDiv(),this.scope.getNativeTransit=function(){a.createChartForTransitDiv(!1)}},function(){"use strict";function a(a,t,e,i,r,n){t.isBhavaMadhya=!1;var s=new ChartDataDisplayCalculation(t,i,n);new ConrollerHelper(t,i,n).bindChartDataDisplayCalls(s)}angular.module("rkpControllerModule",[]).controller("CtrlRkpChart",a).controller("CtrlRkpHome",function(a,t,e,i,r){}),a.$inject=["$http","$scope","$log","ServiceRkpChart","$q","$compile"]}(),CuspTable.prototype.transposeData=function(a){var t=[];for(row of["cuspNum","sl","cuspPercentLength","cuspRasisHtml","cuspNaksHtml","ssl","badhakCuspNum"]){var e={};e._0=row;for(var i=0;i<a.length;i++)e["_"+(i+1)]=a[i][row];t.push(e)}return console.log(t),t},CuspTable.prototype.buildTranspose=function(a,t){var e=this.transposeData(t),i=new Tabulator(a,{layout:"fitData",resizableColumns:!1,columnHeaderVertAlign:"middle",movableRows:!0,movableColumns:!0,data:e,autoResize:!0,columns:[{title:"*",field:"_0",formatter:function(a,t){return a.getValue()}},{title:"1",field:"_1",formatter:function(a,t){return a.getValue()}},{title:"2",field:"_2",formatter:function(a,t){return a.getValue()}},{title:"3",field:"_3",formatter:function(a,t){return a.getValue()}},{title:"4",field:"_4",formatter:function(a,t){return a.getValue()}},{title:"5",field:"_5",formatter:function(a,t){return a.getValue()}},{title:"6",field:"_6",formatter:function(a,t){return a.getValue()}},{title:"7",field:"_7",formatter:function(a,t){return a.getValue()}},{title:"8",field:"_8",formatter:function(a,t){return a.getValue()}},{title:"9",field:"_9",formatter:function(a,t){return a.getValue()}},{title:"10",field:"_10",formatter:function(a,t){return a.getValue()}},{title:"11",field:"_11",formatter:function(a,t){return a.getValue()}},{title:"12",field:"_12",formatter:function(a,t){return a.getValue()}}]});return a.getElementsByClassName("tabulator-header")[0].style.height=0,i},CuspTable.prototype.build=function(a,t){var e=NakshatraUtil.buildNakshatraMap(t);return new Tabulator(a,{layout:"fitData",resizableColumns:!1,columnHeaderVertAlign:"middle",movableRows:!0,movableColumns:!0,data:t,autoResize:!0,columns:[{title:"Cusps Detail",columns:[{title:"*",field:"cuspNum",hozAlign:"right",formatter:function(a,t){return"<span style='color:red; font-weight:bold;'>"+a.getValue()+"</span>"},headerTooltip:"Cusp Number"},{title:"D1",field:"cuspRisingRasi",hozAlign:"center",headerTooltip:"D1 Rasi"},{title:"D9",field:"navamsa",hozAlign:"center",headerTooltip:"Navamsa Rasi"},{title:"Degree",field:"degree",hozAlign:"right"},{title:"Rasi",field:"rl",hozAlign:"right",headerTooltip:"Rasi Lord",formatter:function(a,t){var e=a.getRow().getData();return e.cuspRasisHtml+"  <span style='color:blue; font-weight:bold;'>"+e.rl+"</span>"}},{title:"Nakshatra",field:"nl",hozAlign:"right",headerTooltip:"Nakshatra Lord",formatter:function(a,t){var e=a.getRow().getData();return e.cuspNaksHtml+"  <span style='color:blue; font-weight:bold;'>"+e.nl+"</span>"}},{title:"SL",field:"sl",hozAlign:"center",formatter:function(a,t){return"<span style='color:blue; font-weight:bold;'>"+a.getValue()+"</span>"},headerTooltip:"Sub Lord"},{title:"SS",field:"ssl",hozAlign:"center",formatter:function(a,t){return"<span style='color:blue; font-weight:bold;'>"+a.getValue()+"</span>"},headerTooltip:"Sub-Sub Lord"},{title:"Nakshatras in Cusp",field:"cuspNum",hozAlign:"right",headerTooltip:"Rasi Lord",formatter:function(a,t){return e.get(a.getValue())}}]}]})};var buildDasaButton=function(a){var t=a.dasa,e=document.createElement("button");e.id="maha-dasa-"+t.planet_number,e.innerHTML="<strong>"+t.startDT.substring(0,4)+" - "+t.endDT.substring(0,4)+"</strong>",e.classList.add("btn","btn-outline-primary","btn-sm"),e.onclick=function(a){buildDetailedDasa(a,t)};var i=document.createElement("span");return i.appendChild(document.createTextNode(t.name)),i.classList.add("dmatrix-planet-fullname-class"),i.appendChild(document.createElement("BR")),i.appendChild(e),i};function buildDetailedDasa(a,t){var e=a.currentTarget.id;angular.element(document.getElementById(e)).scope().getDetailedInternalDasa(t.planet_number,t.startDT,t.passed_years)}function buildDetailedDasaTable(a,t){var e=buildTag("div",new Map([["id",a.id+"-detailedDasa"]]),a),i=new Tabulator(e,{layout:"fitData",headerSort:!1,resizableColumns:!1,columnHeaderVertAlign:"middle",movableRows:!1,movableColumns:!1,data:t.internalDasa,dataTree:!0,dataTreeStartExpanded:!1,dataTreeChildField:"internalDasa",autoResize:!0,height:"570",columnMinWidth:75,columns:[{title:t.name,formatter:function(a,t){return a.getRow().getData().name}},{title:"From: "+formatDate(t.startDt).substring(0,10),formatter:function(a,t){var e=a.getRow().getData();return buildDasaTransitLink(formatDate(e.startDate).substring(0,19))}},{title:"To: "+formatDate(t.endDt).substring(0,10),formatter:function(a,t){return formatDate(a.getRow().getData().endDate).substring(0,10)}}]});return a.appendChild(e),i}function buildDetailedDasaTable1(a,t){var e=buildTag("div",new Map([["id",a.id+"-detailedDasa"]]),a),i=new Tabulator(e,{layout:"fitData",headerSort:!1,resizableColumns:!1,columnHeaderVertAlign:"middle",movableRows:!1,movableColumns:!1,data:t.internalDasa,dataTree:!0,dataTreeStartExpanded:!1,dataTreeChildField:"internalDasa",autoResize:!0,height:"570",columnMinWidth:75,columns:[{title:t.name,formatter:function(a,t){return a.getRow().getData().name.substring(0,2)}},{title:"From: "+t.startDT.substring(0,10),formatter:function(a,t){var e=a.getRow().getData();return buildDasaTransitLink(e.startDT.substring(0,19))}},{title:"To: "+t.endDT.substring(0,10),formatter:function(a,t){return a.getRow().getData().endDT.substring(0,19)}}]});return a.appendChild(e),i}var buildDasaTransitLink=function(a){var t=Math.random().toString(36).substr(2,9)+a,e=buildTag("button",new Map([["id",t],["class","btn btn-link btn-sm"]]),void 0,a);return e.onclick=function(t){buildDasaTransitData(t,a)},e};function buildDasaTransitData(a,t){var e=a.currentTarget.id;angular.element(document.getElementById(e)).scope().getDasaTransitData(t)}function buildAnatardasaDasaStructure(a,t,e,i,r){void 0===r&&(r=new Array(9));for(var n=0;n<9;n++){var s=(a+n)%9,l=PlanetUtil.get(s),o=i*(l.period/120),d=t.getTime()+31556952e3*o,u=new Date(d);r[n]={name:l.abbr,startDate:t,endDate:u},e>1&&(r[n].internalDasa=buildAnatardasaDasaStructure(s,t,e-1,o)),t=u}return r}function buildTransitDestinyMatrixTable(a,t,e){for(var i=new Map(e.map(a=>[a.abbr,a])),r=0;r<9;r++){var n=i.get(t[r].abbr);n.d1Rasi=t[r].d1Rasi,n.d1Nak=t[r].d1Nak,n.d1Sub=t[r].d1Sub,n.d1SSub=t[r].d1SSub}var s=[[e[0],e[1],e[2]],[e[3],e[4],e[5]],[e[6],e[7],e[8]]],l=buildTag("div",new Map([["class","px-1 py-1 overflow-auto"]]),a),o=buildTag("table",new Map([["class","dmatrix-table table-sm m-0 p-0"]]),l);buildHorizontalHeader(o);for(r=0;r<3;r++)buildDestinyMatrixSet(r,o,i,s[r],!0)}function buildDestinyMatrixTable(a,t){var e=new Map(t.map(a=>[a.abbr,a])),i=[[t[0],t[1],t[2]],[t[3],t[4],t[5]],[t[6],t[7],t[8]]],r=buildTag("div",new Map([["class","px-1 py-1 overflow-auto"]]),a),n=buildTag("table",new Map([["class","dmatrix-table table-sm m-0 p-0"]]),r);buildHorizontalHeader(n);for(var s=0;s<3;s++)buildDestinyMatrixSet(s,n,e,i[s],!1)}function buildDestinyMatrixSet(a,t,e,i,r){return buildOneCompleteRow(a,"first",i,e,null,null,"PL","Planet",t,r),buildOneCompleteRow(a,"m-1",i,e,"nl",null,"NL","Nakshatra Lord",t,r),buildOneCompleteRow(a,"m-2",i,e,"sl",null,"SL","Sub Lord",t,r),buildOneCompleteRow(a,"last",i,e,"ssl",null,"SS","Sub-sub Lord",t,r),t}function buildOneCompleteRow(a,t,e,i,r,n,s,l,o,d){var u,c=document.createElement("tr");c.classList.add("dmatrix-rowblock-any-row-"+t),c.append(buildVerticalColumnHeader(s,l));for(var h=0;h<3;h++)null==r?u=e[h]:(u=i.get(e[h][r]),null!=n&&(u=i.get(u[n]))),buildOneRowForOneBlock(a,h,t,c,u,d);return"first"==t&&null==r&&(d||buildDasaCell(e,o)),o.appendChild(c),c}function buildOneRowForOneBlock(a,t,e,i,r,n){var s=buildTDWithText(r.abbr);n&&"first"==e?s.classList.add("dmatrix-planet-fullname-class"):s.classList.add("dmatrix-colblock-any-col-first"),i.appendChild(s),i.appendChild(buildTDWithText(r.occCusp)),i.appendChild(buildTDWithText(intArrToString(r.d1Rasi))),i.appendChild(buildTDWithText(intArrToString(r.d1Nak))),i.appendChild(buildTDWithText(intArrToString(r.d1Sub)));var l=buildTDWithText(intArrToString(r.d1SSub));return l.classList.add("dmatrix-colblock-any-col-last"),i.appendChild(l),i}function buildDasaCell(a,t){var e=document.createElement("tr");e.append(buildVerticalColumnHeader(""));for(var i=0;i<3;i++){var r=buildAgeTextButton(a[i]);r.colSpan="6",r.classList.add("dmatrix-colblock-any-col-last"),e.append(r)}t.appendChild(e)}function buildAgeTextButton(a){var t=a.dasa,e=buildTag("button",new Map([["id","dmatrix-dasa-"+t.planet_number],["class","btn btn-outline-secondary btn-sm disabled"]]),void 0,"<strong>Age : ("+a.ageDuringMD+")</strong>");e.onclick=function(a){buildDetailedDasa(a,t)};var i=document.createElement("td"),r=document.createElement("span");return r.innerHTML=t.name+a.retStr+"<sup style='color:red;'>"+getUntenantedSelfStarredStr(a)+"</sup> : ",i.appendChild(r),i.classList.add("dmatrix-planet-fullname-class"),i.appendChild(e),i}function buildHorizontalHeader(a){var t=document.createElement("tr");t.classList.add("dmatrix-row-header");var e=buildColumnHeaderWithText("");e.classList.add("dmatrix-colblock-header"),t.appendChild(e);for(var i=0;i<3;i++)t.appendChild(buildColumnHeaderWithText("")),t.appendChild(buildColumnHeaderWithText("C","Cusp Occupied")),t.appendChild(buildColumnHeaderWithText("R","Cusps by Rasi Lord")),t.appendChild(buildColumnHeaderWithText("N","Cusps by Nakshatra Lord")),t.appendChild(buildColumnHeaderWithText("S","Cusps by Sub Lord")),(e=buildColumnHeaderWithText("SS","Cusps by Sub-sub Lord")).classList.add("dmatrix-colblock-header"),t.appendChild(e);a.appendChild(t)}function buildVerticalColumnHeader(a,t){var e=buildColumnHeaderWithText(a,t);return e.classList.add("dmatrix-colblock-header"),e}function buildColumnHeaderWithText(a,t){var e=buildTDWithText(a,t);return e.classList.add("dmatrix-header-text"),e}function buildTDWithText(a,t){var e=document.createElement("td"),i=document.createElement("span");return i.textContent=a,void 0!==t&&t.length>0&&(i.setAttribute("data-toggle","tooltip"),i.setAttribute("data-placement","right"),i.setAttribute("title",t)),e.appendChild(i),e}!function(){"use strict";angular.module("rkpDirectiveModule",[]).directive("validFile",function(){return{require:"ngModel",scope:{format:"@",upload:"&upload"},link:function(a,t,e,i){t.bind("change",function(e){a.upload({file:e.target.files[0]}),a.$apply(function(){i.$setViewValue(t.val()),i.$render()})})}}})}();const initialDataForChart={ayanamsas:["Aryabhata","Aryabhata Msun","Fagan Bradley","Krishnamurti","Lahiri","Raman","Ss Citra","Ss Revati","Suryasiddhanta","Suryasiddhanta Msun","True Citra","True Pushya","True Revati","Ushashashi","Yukteshwar"],countries:[{x:"AF",y:"Afghanistan"},{x:"AX",y:"Aland Islands"},{x:"AL",y:"Albania"},{x:"DZ",y:"Algeria"},{x:"AS",y:"American Samoa"},{x:"AD",y:"Andorra"},{x:"AO",y:"Angola"},{x:"AI",y:"Anguilla"},{x:"AQ",y:"Antarctica"},{x:"AG",y:"Antigua and Barbuda"},{x:"AR",y:"Argentina"},{x:"AM",y:"Armenia"},{x:"AW",y:"Aruba"},{x:"AU",y:"Australia"},{x:"AT",y:"Austria"},{x:"AZ",y:"Azerbaijan"},{x:"BS",y:"Bahamas"},{x:"BH",y:"Bahrain"},{x:"BD",y:"Bangladesh"},{x:"BB",y:"Barbados"},{x:"BY",y:"Belarus"},{x:"BE",y:"Belgium"},{x:"BZ",y:"Belize"},{x:"BJ",y:"Benin"},{x:"BM",y:"Bermuda"},{x:"BT",y:"Bhutan"},{x:"BO",y:"Bolivia"},{x:"BQ",y:"Bonaire, Saint Eustatius and Saba "},{x:"BA",y:"Bosnia and Herzegovina"},{x:"BW",y:"Botswana"},{x:"BV",y:"Bouvet Island"},{x:"BR",y:"Brazil"},{x:"IO",y:"British Indian Ocean Territory"},{x:"VG",y:"British Virgin Islands"},{x:"BN",y:"Brunei"},{x:"BG",y:"Bulgaria"},{x:"BF",y:"Burkina Faso"},{x:"BI",y:"Burundi"},{x:"CV",y:"Cabo Verde"},{x:"KH",y:"Cambodia"},{x:"CM",y:"Cameroon"},{x:"CA",y:"Canada"},{x:"KY",y:"Cayman Islands"},{x:"CF",y:"Central African Republic"},{x:"TD",y:"Chad"},{x:"CL",y:"Chile"},{x:"CN",y:"China"},{x:"CX",y:"Christmas Island"},{x:"CC",y:"Cocos Islands"},{x:"CO",y:"Colombia"},{x:"KM",y:"Comoros"},{x:"CK",y:"Cook Islands"},{x:"CR",y:"Costa Rica"},{x:"HR",y:"Croatia"},{x:"CU",y:"Cuba"},{x:"CW",y:"Curacao"},{x:"CY",y:"Cyprus"},{x:"CZ",y:"Czechia"},{x:"CD",y:"Democratic Republic of the Congo"},{x:"DK",y:"Denmark"},{x:"DJ",y:"Djibouti"},{x:"DM",y:"Dominica"},{x:"DO",y:"Dominican Republic"},{x:"EC",y:"Ecuador"},{x:"EG",y:"Egypt"},{x:"SV",y:"El Salvador"},{x:"GQ",y:"Equatorial Guinea"},{x:"ER",y:"Eritrea"},{x:"EE",y:"Estonia"},{x:"SZ",y:"Eswatini"},{x:"ET",y:"Ethiopia"},{x:"FK",y:"Falkland Islands"},{x:"FO",y:"Faroe Islands"},{x:"FJ",y:"Fiji"},{x:"FI",y:"Finland"},{x:"FR",y:"France"},{x:"GF",y:"French Guiana"},{x:"PF",y:"French Polynesia"},{x:"TF",y:"French Southern Territories"},{x:"GA",y:"Gabon"},{x:"GM",y:"Gambia"},{x:"GE",y:"Georgia"},{x:"DE",y:"Germany"},{x:"GH",y:"Ghana"},{x:"GI",y:"Gibraltar"},{x:"GR",y:"Greece"},{x:"GL",y:"Greenland"},{x:"GD",y:"Grenada"},{x:"GP",y:"Guadeloupe"},{x:"GU",y:"Guam"},{x:"GT",y:"Guatemala"},{x:"GG",y:"Guernsey"},{x:"GN",y:"Guinea"},{x:"GW",y:"Guinea-Bissau"},{x:"GY",y:"Guyana"},{x:"HT",y:"Haiti"},{x:"HM",y:"Heard Island and McDonald Islands"},{x:"HN",y:"Honduras"},{x:"HK",y:"Hong Kong"},{x:"HU",y:"Hungary"},{x:"IS",y:"Iceland"},{x:"IN",y:"India"},{x:"ID",y:"Indonesia"},{x:"IR",y:"Iran"},{x:"IQ",y:"Iraq"},{x:"IE",y:"Ireland"},{x:"IM",y:"Isle of Man"},{x:"IL",y:"Israel"},{x:"IT",y:"Italy"},{x:"CI",y:"Ivory Coast"},{x:"JM",y:"Jamaica"},{x:"JP",y:"Japan"},{x:"JE",y:"Jersey"},{x:"JO",y:"Jordan"},{x:"KZ",y:"Kazakhstan"},{x:"KE",y:"Kenya"},{x:"KI",y:"Kiribati"},{x:"XK",y:"Kosovo"},{x:"KW",y:"Kuwait"},{x:"KG",y:"Kyrgyzstan"},{x:"LA",y:"Laos"},{x:"LV",y:"Latvia"},{x:"LB",y:"Lebanon"},{x:"LS",y:"Lesotho"},{x:"LR",y:"Liberia"},{x:"LY",y:"Libya"},{x:"LI",y:"Liechtenstein"},{x:"LT",y:"Lithuania"},{x:"LU",y:"Luxembourg"},{x:"MO",y:"Macao"},{x:"MG",y:"Madagascar"},{x:"MW",y:"Malawi"},{x:"MY",y:"Malaysia"},{x:"MV",y:"Maldives"},{x:"ML",y:"Mali"},{x:"MT",y:"Malta"},{x:"MH",y:"Marshall Islands"},{x:"MQ",y:"Martinique"},{x:"MR",y:"Mauritania"},{x:"MU",y:"Mauritius"},{x:"YT",y:"Mayotte"},{x:"MX",y:"Mexico"},{x:"FM",y:"Micronesia"},{x:"MD",y:"Moldova"},{x:"MC",y:"Monaco"},{x:"MN",y:"Mongolia"},{x:"ME",y:"Montenegro"},{x:"MS",y:"Montserrat"},{x:"MA",y:"Morocco"},{x:"MZ",y:"Mozambique"},{x:"MM",y:"Myanmar"},{x:"NA",y:"Namibia"},{x:"NR",y:"Nauru"},{x:"NP",y:"Nepal"},{x:"NL",y:"Netherlands"},{x:"AN",y:"Netherlands Antilles"},{x:"NC",y:"New Caledonia"},{x:"NZ",y:"New Zealand"},{x:"NI",y:"Nicaragua"},{x:"NE",y:"Niger"},{x:"NG",y:"Nigeria"},{x:"NU",y:"Niue"},{x:"NF",y:"Norfolk Island"},{x:"KP",y:"North Korea"},{x:"MK",y:"North Macedonia"},{x:"MP",y:"Northern Mariana Islands"},{x:"NO",y:"Norway"},{x:"OM",y:"Oman"},{x:"PK",y:"Pakistan"},{x:"PW",y:"Palau"},{x:"PS",y:"Palestinian Territory"},{x:"PA",y:"Panama"},{x:"PG",y:"Papua New Guinea"},{x:"PY",y:"Paraguay"},{x:"PE",y:"Peru"},{x:"PH",y:"Philippines"},{x:"PN",y:"Pitcairn"},{x:"PL",y:"Poland"},{x:"PT",y:"Portugal"},{x:"PR",y:"Puerto Rico"},{x:"QA",y:"Qatar"},{x:"CG",y:"Republic of the Congo"},{x:"RE",y:"Reunion"},{x:"RO",y:"Romania"},{x:"RU",y:"Russia"},{x:"RW",y:"Rwanda"},{x:"BL",y:"Saint Barthelemy"},{x:"SH",y:"Saint Helena"},{x:"KN",y:"Saint Kitts and Nevis"},{x:"LC",y:"Saint Lucia"},{x:"MF",y:"Saint Martin"},{x:"PM",y:"Saint Pierre and Miquelon"},{x:"VC",y:"Saint Vincent and the Grenadines"},{x:"WS",y:"Samoa"},{x:"SM",y:"San Marino"},{x:"ST",y:"Sao Tome and Principe"},{x:"SA",y:"Saudi Arabia"},{x:"SN",y:"Senegal"},{x:"RS",y:"Serbia"},{x:"CS",y:"Serbia and Montenegro"},{x:"SC",y:"Seychelles"},{x:"SL",y:"Sierra Leone"},{x:"SG",y:"Singapore"},{x:"SX",y:"Sint Maarten"},{x:"SK",y:"Slovakia"},{x:"SI",y:"Slovenia"},{x:"SB",y:"Solomon Islands"},{x:"SO",y:"Somalia"},{x:"ZA",y:"South Africa"},{x:"GS",y:"South Georgia and the South Sandwich Islands"},{x:"KR",y:"South Korea"},{x:"SS",y:"South Sudan"},{x:"ES",y:"Spain"},{x:"LK",y:"Sri Lanka"},{x:"SD",y:"Sudan"},{x:"SR",y:"Suriname"},{x:"SJ",y:"Svalbard and Jan Mayen"},{x:"SE",y:"Sweden"},{x:"CH",y:"Switzerland"},{x:"SY",y:"Syria"},{x:"TW",y:"Taiwan"},{x:"TJ",y:"Tajikistan"},{x:"TZ",y:"Tanzania"},{x:"TH",y:"Thailand"},{x:"TL",y:"Timor Leste"},{x:"TG",y:"Togo"},{x:"TK",y:"Tokelau"},{x:"TO",y:"Tonga"},{x:"TT",y:"Trinidad and Tobago"},{x:"TN",y:"Tunisia"},{x:"TR",y:"Turkey"},{x:"TM",y:"Turkmenistan"},{x:"TC",y:"Turks and Caicos Islands"},{x:"TV",y:"Tuvalu"},{x:"VI",y:"U.S. Virgin Islands"},{x:"UG",y:"Uganda"},{x:"UA",y:"Ukraine"},{x:"AE",y:"United Arab Emirates"},{x:"GB",y:"United Kingdom"},{x:"US",y:"United States"},{x:"UM",y:"United States Minor Outlying Islands"},{x:"UY",y:"Uruguay"},{x:"UZ",y:"Uzbekistan"},{x:"VU",y:"Vanuatu"},{x:"VA",y:"Vatican"},{x:"VE",y:"Venezuela"},{x:"VN",y:"Vietnam"},{x:"WF",y:"Wallis and Futuna"},{x:"EH",y:"Western Sahara"},{x:"YE",y:"Yemen"},{x:"ZM",y:"Zambia"},{x:"ZW",y:"Zimbabwe"}],states:[{x:"01",y:"Andaman And Nicobar"},{x:"02",y:"Andhra Pradesh"},{x:"30",y:"Arunachal Pradesh"},{x:"03",y:"Assam"},{x:"34",y:"Bihar"},{x:"05",y:"Chandigarh"},{x:"37",y:"Chhattisgarh"},{x:"06",y:"Dadra And Nagar Haveli"},{x:"32",y:"Daman And Diu"},{x:"07",y:"Delhi"},{x:"33",y:"Goa"},{x:"09",y:"Gujarat"},{x:"10",y:"Haryana"},{x:"11",y:"Himachal Pradesh"},{x:"12",y:"Jammu And Kashmir"},{x:"38",y:"Jharkhand"},{x:"19",y:"Karnataka"},{x:"13",y:"Kerala"},{x:"14",y:"Laccadives"},{x:"41",y:"Ladakh"},{x:"35",y:"Madhya Pradesh"},{x:"16",y:"Maharashtra"},{x:"17",y:"Manipur"},{x:"18",y:"Meghalaya"},{x:"31",y:"Mizoram"},{x:"20",y:"Nagaland"},{x:"21",y:"Odisha"},{x:"22",y:"Puducherry"},{x:"23",y:"Punjab"},{x:"24",y:"Rajasthan"},{x:"29",y:"Sikkim"},{x:"25",y:"Tamil Nadu"},{x:"40",y:"Telangana"},{x:"26",y:"Tripura"},{x:"36",y:"Uttar Pradesh"},{x:"39",y:"Uttarakhand"},{x:"28",y:"West Bengal"}]},karakaArray=["AK","AmK","BK","MK","PiK","PuK","GK","DK"];function buildNaisargikMahaDasaTabulator(a,t,e){for(var i=new Date(e.valueOf()),r=new Array(9),n=0;n<9;n++)r[n]={},r[n].startDate=i,(i=new Date(i.valueOf())).setFullYear(i.getFullYear()+PlanetUtil.get(t[n]).exaltationRasi),r[n].endDate=i,r[n].planet_number=t[n];return new Tabulator(a,{layout:"fitData",headerSort:!1,resizableColumns:!1,movableRows:!1,movableColumns:!1,data:r,autoResize:!0,height:"570",columnMinWidth:120,initialSort:[{column:"startDate",dir:"asc"}],columns:[{title:"Planet Dasa",field:"startDate",formatter:function(a,t){return buildPlanetNaisargikDasaButton(a.getRow().getData())}}]})}var buildPlanetNaisargikDasaButton=function(a){var t=a.planet_number,e=a.startDate,i=a.endDate,r=document.createElement("button");r.id="naisargik-planet-dasa-1"+t,r.innerHTML="<strong>"+e.getFullYear()+" - "+i.getFullYear()+"</strong>",r.classList.add("btn","btn-outline-primary","btn-sm"),r.onclick=function(a){buildPlanetNaisargikDetailedDasa(a,t,e)};var n=document.createElement("button");n.id="naisargik-planet-dasa-2"+t,n.innerHTML="<strong>"+(e.getFullYear()+54)+" - "+(i.getFullYear()+54)+"</strong>",n.classList.add("btn","btn-outline-primary","btn-sm"),n.onclick=function(a){buildPlanetNaisargikDetailedDasa(a,t,e,54)};var s=document.createElement("div");return s.appendChild(document.createTextNode(PlanetUtil.get(t).name)),s.classList.add("dmatrix-planet-fullname-class"),s.appendChild(document.createElement("BR")),buildTag("span",void 0,s).appendChild(r),buildTag("span",new Map([["class","pl-1"]]),s).appendChild(n),s};function buildPlanetNaisargikDetailedDasa(a,t,e,i){var r=a.currentTarget.id;angular.element(document.getElementById(r)).scope().getDetailedInternalPlanetNaisargikDasa(t,e,i)}function buildPlanetNaisargikDetailedDasaTable(a,t){var e=buildTag("div",new Map([["id",a.id+"-detailedDasa"]]),a),i=new Tabulator(e,{layout:"fitData",headerSort:!1,resizableColumns:!1,columnHeaderVertAlign:"middle",movableRows:!1,movableColumns:!1,data:t.internalDasa,dataTree:!0,dataTreeStartExpanded:!1,dataTreeChildField:"internalDasa",autoResize:!0,height:"570",columnMinWidth:75,columns:[{title:t.name,field:"name"},{title:"From: "+formatDate(t.startDate).substring(0,10),formatter:function(a,t){var e=a.getRow().getData();return buildDasaTransitLink(formatDate(e.startDate))}},{title:"To: "+formatDate(t.endDate).substring(0,10),formatter:function(a,t){return formatDate(a.getRow().getData().endDate).substring(0,10)}}]});return a.appendChild(e),i}function buildNaisargikDasaPlanetSequence(a,t){var e=30*[t[0].cuspRisingRasi-1],i=a.map(a=>({degree360:a.degree360,planet_number:PlanetUtil.getPlanetNumber(a.abbr)}));i.sort((a,t)=>a.degree360-t.degree360);for(var r=0;r<9;r++){if(i[0].degree360>=e)break;i.push(i.shift())}return i.map(a=>a.planet_number)}function buildNaisargikDasaStructure(a,t,e,i,r,n){var s=r.indexOf(a);void 0===n&&(n=new Array(9));for(var l=0;l<9;l++){var o=r[(s+l)%9],d=PlanetUtil.get(o),u=i*(d.exaltationRasi/54),c=t.getTime()+31556952e3*u,h=new Date(c);n[l]={name:d.abbr,startDate:t,endDate:h},e>1&&(n[l].internalDasa=buildNaisargikDasaStructure(o,t,e-1,u,r)),t=h}return n}function buildNaisargikHouseDasaTabulator(a,t){for(var e=new Date(t.valueOf()),i=new Array(12),r=0;r<12;r++)i[r]={house:r+1},i[r].startDate=e,(e=new Date(e.valueOf())).setFullYear(e.getFullYear()+12),i[r].endDate=e;return new Tabulator(a,{layout:"fitData",headerSort:!1,resizableColumns:!1,movableRows:!1,movableColumns:!1,data:i,autoResize:!0,height:"570",columnMinWidth:120,initialSort:[{column:"startDate",dir:"asc"}],columns:[{title:"House Dasa",field:"startDate",formatter:function(a,t){return buildHouseNaisargikDasaButton(a.getRow().getData())}}]})}var buildHouseNaisargikDasaButton=function(a){var t=a.house,e=a.startDate,i=a.endDate,r=document.createElement("button");r.id="naisargik-house-maha-dasa"+t,r.innerHTML="<strong>"+e.getFullYear()+" - "+i.getFullYear()+"</strong>",r.classList.add("btn","btn-outline-primary","btn-sm"),r.onclick=function(a){buildHouseNaisargikDetailedDasa(a,t,e)};var n=document.createElement("div");return n.appendChild(document.createTextNode("House: "+t)),n.classList.add("dmatrix-planet-fullname-class"),n.appendChild(document.createElement("BR")),buildTag("span",void 0,n).appendChild(r),n};function buildHouseNaisargikDetailedDasa(a,t,e,i){var r=a.currentTarget.id;angular.element(document.getElementById(r)).scope().getDetailedInternalHouseNaisargikDasa(t,e,i)}function buildNaisargikHouseDetailedDasaTable(a,t){var e=buildTag("div",new Map([["id",a.id+"-detailedDasa"]]),a),i=new Tabulator(e,{layout:"fitData",headerSort:!1,resizableColumns:!1,columnHeaderVertAlign:"middle",movableRows:!1,movableColumns:!1,data:t.internalDasa,dataTree:!0,dataTreeStartExpanded:!1,dataTreeChildField:"internalDasa",autoResize:!0,height:"570",columnMinWidth:75,columns:[{title:"House: "+t.name,field:"name"},{title:"From: "+formatDate(t.startDate).substring(0,10),formatter:function(a,t){var e=a.getRow().getData();return buildDasaTransitLink(formatDate(e.startDate))}},{title:"To: "+formatDate(t.endDate).substring(0,10),formatter:function(a,t){return formatDate(a.getRow().getData().endDate).substring(0,10)}}]});return a.appendChild(e),i}function buildNaisargikRasiDasaStructure(a,t,e,i,r){void 0===r&&(r=new Array(12)),i||(i=24);for(var n=0;n<12;n++){var s=PlanetUtil.get((a+n)%12),l=i/24*(s.naisargikPeriod/12),o=t.getTime()+31556952e3*l,d=new Date(o);r[n]={name:s.abbr,startDate:t,endDate:d},e>1&&(r[n].internalDasa=buildNaisargikRasiDasaStructure(s.number,t,e-1,l)),t=d}return r}function buildNaisargikHouseDasaStructure(a,t,e,i){var r=new Array(12);i||(i=12);for(var n=0;n<12;n++){var s=(a+n)%12;s=0==s?12:s;var l=i/12;if(1==l)(d=new Date(t.valueOf())).setFullYear(d.getFullYear()+1);else var o=t.getTime()+31556952e3*l,d=new Date(o);r[n]={name:s,startDate:t,endDate:d},e>1&&(r[n].internalDasa=buildNaisargikHouseDasaStructure(s,t,e-1,l)),t=d}return r}function buildNaisargikRasiDasaTabulator(a,t){for(var e=new Date(t.valueOf()),i=new Array(12),r=1;r<6;r++)i[r]={cycle:r},i[r].startDate=e,(e=new Date(e.valueOf())).setFullYear(e.getFullYear()+24),i[r].endDate=e;var n=buildTag("div",void 0,a);return new Tabulator(n,{layout:"fitData",headerSort:!1,resizableColumns:!1,movableRows:!1,movableColumns:!1,data:i,autoResize:!0,height:"450",columnMinWidth:120,initialSort:[{column:"startDate",dir:"asc"}],columns:[{title:"Rasi Dasa",field:"startDate",formatter:function(a,t){return buildRasiNaisargikDasaButton(a.getRow().getData())}}]})}var buildRasiNaisargikDasaButton=function(a){var t=a.cycle,e=a.startDate,i=a.endDate,r=document.createElement("button");r.id="naisargik-rasi-maha-dasa"+t,r.innerHTML="<strong>"+e.getFullYear()+" - "+i.getFullYear()+"</strong>",r.classList.add("btn","btn-outline-primary","btn-sm"),r.onclick=function(a){buildRasiNaisargikDetailedDasa(a,e,t)};var n=document.createElement("div");return n.appendChild(document.createTextNode("Cycle: "+t)),n.classList.add("dmatrix-planet-fullname-class"),n.appendChild(document.createElement("BR")),buildTag("span",void 0,n).appendChild(r),n};function buildRasiNaisargikDetailedDasa(a,t,e){var i=a.currentTarget.id;angular.element(document.getElementById(i)).scope().getDetailedInternalRasiNaisargikDasa(t,e)}function buildNaisargikRasiDetailedDasaTable(a,t){var e=buildTag("div",new Map([["id",a.id+"-detailedDasa"]]),a),i=new Tabulator(e,{layout:"fitData",headerSort:!1,resizableColumns:!1,columnHeaderVertAlign:"middle",movableRows:!1,movableColumns:!1,data:t.internalDasa,dataTree:!0,dataTreeStartExpanded:!1,dataTreeChildField:"internalDasa",autoResize:!0,height:"570",columnMinWidth:75,columns:[{title:"Cycle: "+t.name,field:"name"},{title:"From: "+formatDate(t.startDate).substring(0,10),formatter:function(a,t){var e=a.getRow().getData();return buildDasaTransitLink(formatDate(e.startDate))}},{title:"To: "+formatDate(t.endDate).substring(0,10),formatter:function(a,t){return formatDate(a.getRow().getData().endDate).substring(0,10)}}]});return a.appendChild(e),i}function buildNaisargikRasiDasaStructure(a,t,e,i,r){void 0===r&&(r=new Array(12)),i||(i=24);for(var n=0;n<12;n++){var s=RasiUtil.get(a+n),l=i/24*(s.naisargikPeriod/12),o=t.getTime()+31556952e3*l,d=new Date(o);r[n]={name:s.abbr,startDate:t,endDate:d},e>1&&(r[n].internalDasa=buildNaisargikRasiDasaStructure(s.number,t,e-1,l)),t=d}return r}function buildNaisargikStartRasiSelect(a,t,e){var i=buildTag("div",void 0,a);return buildTag("label",new Map([["for","selectNaisargikStartRasiDiv"],["class","p-0 m-0"]]),i,"Start Rasi"),buildTag("BR",void 0,i),buildTag("select",new Map([["id","selectNaisargikStartRasiDiv"],["ng-options","rasi.number as rasi.name for rasi in rasiArray"],["ng-model","naisargikStartRasiModel"],["class","custom-select form-control w-auto"]]),i),e(i)(t),i}class Nakshatra{constructor(a,t,e){return this.number=a,this.name=t,this.deity=e,this.abbr=t.length>5?t.substring(0,6):t,this}}class NakshatraUtil{static buildNakshatraMap(a){for(var t=new Map,e=new Map(a.map(a=>[a.cuspNum,this.getNakshatraAndRemainingPercentDegree(a.startDegree360)])),i=1;i<13;i++){for(var r=e.get(i),n=e.get(12==i?1:i+1),s=nakshatraArray[r.nakNumber-1],l=r.percent,o=nakshatraArray[n.nakNumber-1],d=s.abbr+"-<span style='color:blue;'>"+PlanetUtil.get(s.number).abbr+"</span> ["+l+"%]",u=s.number+1;28==u&&(u=1),u!=o.number;u++)d=d+", "+nakshatraArray[u-1].abbr+"-<span style='color:blue;'>"+PlanetUtil.get(nakshatraArray[u-1].number).abbr+"</span>";d=d+", "+o.abbr+"-<span style='color:blue;'>"+PlanetUtil.get(o.number).abbr+"</span>",t.set(i,d)}return t}static getNakshatraAndRemainingPercentDegree(a){var t=a%NAK_LENGTH,e=Math.floor(a/NAK_LENGTH);return 0==t?t=NAK_LENGTH:e+=1,{nakNumber:e,percent:(100*(1-t/NAK_LENGTH)).toFixed(0)}}}const NAK_LENGTH=800/60,nakshatraArray=[new Nakshatra(1,"Ashwini","Ashwini Kumaras"),new Nakshatra(2,"Bharani","Yama"),new Nakshatra(3,"Krittika","Agni"),new Nakshatra(4,"Rohini","Brahma"),new Nakshatra(5,"Mrigashira","Soma/Chandra"),new Nakshatra(6,"Ardra","Rudra"),new Nakshatra(7,"Punarvasu","Aditi"),new Nakshatra(8,"Pushya","Brihaspati"),new Nakshatra(9,"Ashlesha","Sarpas/Nagas"),new Nakshatra(10,"Magha","Pitris"),new Nakshatra(11,"P Phalguni","Bhaga"),new Nakshatra(12,"U Phalguni","Aryaman"),new Nakshatra(13,"Hasta","Savitur"),new Nakshatra(14,"Chitra","Vishwakarma"),new Nakshatra(15,"Swati","Vayu"),new Nakshatra(16,"Vishakha","Indra-Agni"),new Nakshatra(17,"Anuradha","Mitra"),new Nakshatra(18,"Jyeshtha","Indra"),new Nakshatra(19,"Mula","Nirruti"),new Nakshatra(20,"P Ashadha","Apah"),new Nakshatra(21,"U Ashadha","Viswadevas"),new Nakshatra(22,"Shravana","Vishnu"),new Nakshatra(23,"Dhanishtha","Asta Vasus"),new Nakshatra(24,"Shatbhisha","Varuna"),new Nakshatra(25,"P Bhadrapad","Aja Ekapada"),new Nakshatra(26,"U Bhadrapad","Ahir Budhyana"),new Nakshatra(27,"Revati","Pushan")];function PlanetTable(a,t){return this.scope=a,this.ServiceRkpChart=t,that=this,this}PlanetTable.prototype.addOuterPlanetFilterCheckbox=function(a){var t=buildTag("div",new Map([["class","form-check"]]),a),e=buildTag("input",new Map([["id",a.id+"outerPlanetRadio"],["type","checkbox"],["class","form-check-input"]]),t);return buildTag("label",new Map([["for",a.id+"outerPlanetRadio"],["class","form-check-label"]]),t,"Display Outer Planets"),e},PlanetTable.prototype.addClickEventToCheckbox=function(a,t){var e=this;a.onclick=function(a){a.target.checked?e.showOuterPlanet(t):e.hideOuterPlanet(t)}},PlanetTable.prototype.hideOuterPlanet=function(a){a.addFilter("abbr","!=","Pl"),a.addFilter("abbr","!=","Ne"),a.addFilter("abbr","!=","Ur")},PlanetTable.prototype.showOuterPlanet=function(a){a.removeFilter("abbr","!=","Pl"),a.removeFilter("abbr","!=","Ne"),a.removeFilter("abbr","!=","Ur")},PlanetTable.prototype.build=function(a,t){var e=this.addOuterPlanetFilterCheckbox(a),i=buildTag("div",new Map([["id",a.id+"-planets"]]),a),r=this.buildTable(i,t);return this.hideOuterPlanet(r),this.addClickEventToCheckbox(e,r),r},PlanetTable.prototype.buildTable=function(a,t){return new Tabulator(a,{layout:"fitData",resizableColumns:!1,autoResize:!0,data:t,movableRows:!0,movableColumns:!0,columnHeaderVertAlign:"bottom",columns:[{title:"Planets Detail",columns:[{title:"Rasi",field:"rasi",hozAlign:"left",headerVertical:!0,sortable:!0,sorter:function(a,t,e,i){return e.getData().degree360-i.getData().degree360}},{title:"Degree",field:"degree",hozAlign:"right"},{title:"Nak",field:"nakshatra",hozAlign:"right",sortable:!0,sorter:function(a,t,e,i){return e.getData().degree360-i.getData().degree360}},{title:"D1",field:"rasiNum",hozAlign:"center",headerTooltip:"D1 Rasi"},{title:"D9",field:"navamsa",hozAlign:"center",headerTooltip:"Navamsa Rasi"},{title:"*",field:"name",hozAlign:"left",formatter:function(a,t){var e=a.getRow().getData();return"<span style='color:red; font-weight:bold;'>"+e.abbr+e.retStr+"<sup style='color:black;'>"+getUntenantedSelfStarredStr(e)+"</sup></span>"},sortable:!0,sorter:function(a,t,e,i){return e.getData().dasa.planet_number-i.getData().dasa.planet_number},headerTooltip:"Planet"},{title:"NL",field:"nl",hozAlign:"center",headerTooltip:"Nakshatra Lord"},{title:"SL",field:"sl",hozAlign:"center",headerTooltip:"Sub Lord"},{title:"SS",field:"ssl",hozAlign:"center",headerTooltip:"Sub-Sub Lord"},{title:"CP",field:"cp",hozAlign:"right",headerTooltip:"Cusp Point(Position in cusp)"},{title:"C",field:"occCusp",hozAlign:"right",sortable:!0,sorter:function(a,t,e,i){return e.getData().occCusp===i.getData().occCusp?e.getData().cp-i.getData().cp:e.getData().occCusp-i.getData().occCusp},headerTooltip:"Occupied Cusp"},{title:"Owned Cusp(s) by:",columns:[{title:"R",field:"d1Rasi",hozAlign:"right",formatter:this.cuspDataFormatter,sorter:"array",sorterParams:{type:"min",alignEmptyValues:"top"},headerTooltip:"Rasis"},{title:"N",field:"d1Nak",hozAlign:"right",formatter:this.cuspDataFormatter,sorter:"array",sorterParams:{type:"min",alignEmptyValues:"top"},headerTooltip:"Nakshatras"},{title:"S",field:"d1Sub",hozAlign:"right",formatter:this.cuspDataFormatter,sorter:"array",sorterParams:{type:"min",alignEmptyValues:"top"},headerTooltip:"Sub"},{title:"SS",field:"d1SSub",hozAlign:"right",formatter:this.cuspDataFormatter,sorter:"array",sorterParams:{type:"min",alignEmptyValues:"top"},headerTooltip:"Sub-sub"}]},{title:"360",field:"degree360",hozAlign:"right",visible:!1,headerVertical:!0,formatter:function(a,t){return a.getValue().toFixed(2)},headerTooltip:"Rasis in Cusp"},{title:"Dasa<br> End",field:"dasa.endDT",visible:!1,formatter:this.displayDasaButton,cellClick:this.getDetailedDasa},{title:"abbr",field:"abbr",visible:!1}]}]})},PlanetTable.prototype.cuspDataFormatter=function(a,t){return intArrToString(a.getValue())};class Planet{constructor(a,t,e,i,r,n,s){return this.number=a,this.name=t,this.abbr=e,this.period=i,this.exaltationRasi=r,this}}const TOTAL_PERIOD=120,planetArray=[new Planet(1,"Ketu","Ke",7,9,"0:46:40",[5,9]),new Planet(2,"Venus","Ve",20,12,"2:13:20",[7]),new Planet(3,"Sun","Su",6,1,"0:40:0",[7]),new Planet(4,"Moon","Mo",10,2,"1:6:40",[7]),new Planet(5,"Mars","Ma",7,10,"0:46:40",[4,7,8]),new Planet(6,"Rahu","Ra",18,3,"2:0:0",[5,9]),new Planet(7,"Jupiter","Ju",16,4,"1:46:40",[5,7,9]),new Planet(8,"Saturn","Sa",19,7,"2:6:40",[3,7,10]),new Planet(9,"Mercury","Me",17,6,"1:53:20",[7])],map1=new Map;map1.set("a",1),map1.set("b",2),map1.set("c",3);const planetAbbrNumberMapping=new Map;planetAbbrNumberMapping.set("Ke",1),planetAbbrNumberMapping.set("Ve",2),planetAbbrNumberMapping.set("Su",3),planetAbbrNumberMapping.set("Mo",4),planetAbbrNumberMapping.set("Ma",5),planetAbbrNumberMapping.set("Ra",6),planetAbbrNumberMapping.set("Ju",7),planetAbbrNumberMapping.set("Sa",8),planetAbbrNumberMapping.set("Me",9);class PlanetUtil{static get(a){return planetArray[(a=a%9==0?9:a%9)-1]}static getPlanetNumber(a){return planetAbbrNumberMapping.get(a)}}class Rasi{constructor(a,t,e,i,r){return this.number=a,this.name=t,this.abbr=e,this.planetLord=i,this.naisargikPeriod=r,this}}const rasiArray=[new Rasi(1,"Aries","Ari","Ma",12),new Rasi(2,"Taurus","Tau","Ve",15),new Rasi(3,"Gemini","Gem","Me",22),new Rasi(4,"Cancer","Can","Mo",30),new Rasi(5,"Leo","Leo","Su",32),new Rasi(6,"Virgo","Vir","Me",33),new Rasi(7,"Libra","Lib","Ve",33),new Rasi(8,"Scorpius","Sco","Ma",32),new Rasi(9,"Sagittarius","Sag","Ju",30),new Rasi(10,"Capricorn","Cap","Sa",22),new Rasi(11,"Aquarius","Aqu","Sa",15),new Rasi(12,"Pisces","Pis","Ju",12)],rasiNameNumberMapping=new Map;rasiNameNumberMapping.set("1","Aries"),rasiNameNumberMapping.set("2","Taurus"),rasiNameNumberMapping.set("3","Gemini"),rasiNameNumberMapping.set("4","Cancer"),rasiNameNumberMapping.set("5","Leo"),rasiNameNumberMapping.set("6","Virgo"),rasiNameNumberMapping.set("7","Libra"),rasiNameNumberMapping.set("8","Scorpius"),rasiNameNumberMapping.set("9","Sagittarius"),rasiNameNumberMapping.set("10","Capricorn"),rasiNameNumberMapping.set("11","Aquarius"),rasiNameNumberMapping.set("12","Pisces");const rasiNameNumberMapping1={AB:"Abia",AJ:"Abuja",AN:"Anambra"};class RasiUtil{static get(a){return rasiArray[(a=a%12==0?12:a%12)-1]}static getRasiNumber(a){return planetAbbrNumberMapping.get(a)}}!function(){"use strict";function a(a,t,e){var i=this;i.ayanamsas,i.chartData,i.transitData,i.birthChartRotartion,i.countries,i.defaultCountry="IN",i.defaultState="01",i.defaultAyanamsa="Lahiri",this.setChartData=function(a){i.chartData=a},this.setTransitData=function(a){i.transitData=a},this.creatNewChartFromFile=function(t){return a.get(contextPath+"/chart/"+t).then(function(a){return a},function(a){return a})},this.creatNewChart=function(t){return a.post(contextPath+"/chart/",t).then(function(a){return a},function(a){return a})},this.getCachedChartData=function(){return i.chartData},this.getCachedTransitData=function(){return i.transitData},this.initialData=function(){return a.get(contextPath+"/initialData?country="+i.defaultCountry).then(function(a){return a},function(a){return a})},this.fetchPlaceList=function(t){var e="";return t&&(e="/"+t),a.get(contextPath+"/place/list"+e).then(function(a){return a},function(a){return a})},this.searchCities=function(t,e,i,r){var n="/place/search/"+e+(i?"/"+i:"")+(r?"/"+r:"")+"?citySearch="+t;return a.get(contextPath+n).then(function(a){return a},function(a){return a})},this.getDetailedDasa=function(t,e,i){var r={planetNumber:t,startDateTime:e,passedYears:i};return a.post(contextPath+"/detaileddasa/",r).then(function(a){return a},function(a){return a})},t.info("ChartService is initialzied")}angular.module("rkpServiceModule",[]).service("ServiceRkpChart",a),a.$inject=["$http","$log","$q"]}();class ChartHousePlacement{rasiPlacement(a,t){return this.rasi={},this.rasi.x=a,this.rasi.y=t,this}planetPlacement(a,t,e,i,r,n){return this.planet={},this.planet.xStartByUnit=a,this.planet.yStartByUnit=t,this.planet.widthInUnits=e,this.planet.heightInUnits=i,this.planet.placement=r,this.planet.textAnchor=n,this}}const placements=new Map;placements.set(1,(new ChartHousePlacement).rasiPlacement(4,3.65).planetPlacement(2,0,4,3,[1,4,8,4],"middle")),placements.set(4,(new ChartHousePlacement).rasiPlacement(2,5.65).planetPlacement(0,2,4,3,[1,4,8,4],"middle")),placements.set(7,(new ChartHousePlacement).rasiPlacement(4,7.65).planetPlacement(2,4,4,3,[1,4,8,4],"middle")),placements.set(10,(new ChartHousePlacement).rasiPlacement(6,5.65).planetPlacement(4,2,4,3,[1,4,8,4],"middle")),placements.set(2,(new ChartHousePlacement).rasiPlacement(2,1.65).planetPlacement(.5,0,3,1.5,[6,4],"middle")),placements.set(12,(new ChartHousePlacement).rasiPlacement(6,1.65).planetPlacement(4.5,0,3,1.5,[6,4],"middle")),placements.set(6,(new ChartHousePlacement).rasiPlacement(2,6.35).planetPlacement(.5,6.5,3,1.5,[4,6],"middle")),placements.set(8,(new ChartHousePlacement).rasiPlacement(6,6.35).planetPlacement(4.5,6.5,3,1.5,[4,6],"middle")),placements.set(3,(new ChartHousePlacement).rasiPlacement(0,3.65).planetPlacement(0,.25,2,3,[1,3,4,3],"start")),placements.set(5,(new ChartHousePlacement).rasiPlacement(0,7.65).planetPlacement(0,4.25,2,3,[1,3,4,3],"start")),placements.set(9,(new ChartHousePlacement).rasiPlacement(7.65,7.65).planetPlacement(6,4.25,1.9,3,[1,2,4,2],"end")),placements.set(11,(new ChartHousePlacement).rasiPlacement(7.65,3.65).planetPlacement(6,.25,1.9,3,[1,2,4,2],"end"));class TraditionalChart{constructor(a,t){this.lineWidth=1,this.lineColor="black",this.width=a,this.height=t,this.widthUnit=this.width/8,this.heightUnit=this.height/8}buildCuspChart(a,t,e){var i=this.getRotatedHouseMap(e),r=this.createStructure(a),n=groupBy(t.planets,"occCusp");for(const a of t.cuspViewModals){var s,l=n[""+a.cuspNum];if(void 0!==l){s=[];for(const a of l)s.push({size:a.retStr.length>0?4:2,name:a.abbr+""+a.retStr})}else s=void 0;this.fillHouseWithRasiAndPlanets(r,i?i.get(a.cuspNum):a.cuspNum,a.cuspRisingRasi,s)}return r}buildRasiChart(a,t,e){for(var i=this.getRotatedHouseMap(e),r=this.createStructure(a),n=groupBy(t.planets,"rasiNum"),s=t.cuspViewModals[0].cuspRisingRasi,l=0;l<12;l++){var o,d=s+l,u=n[d=d>12?d%12:d];if(void 0!==u){o=[];for(const a of u)o.push({size:a.retStr.length>0?4:2,name:a.abbr+""+a.retStr})}else o=void 0;this.fillHouseWithRasiAndPlanets(r,i?i.get(l+1):l+1,d,o)}return r}buildDivisionalChart(a,t,e){for(var i=this.getRotatedHouseMap(e),r=this.createStructure(a),n=0;n<12;n++){var s=t.ascendentRasi+n;s=s>12?s%12:s;var l=t.rasiPlanets[s];void 0!==l&&(l=l.map(a=>({size:2,name:a}))),this.fillHouseWithRasiAndPlanets(r,i?i.get(n+1):n+1,s,l)}return void 0!==a&&a.appendChild(r),r}getRotatedHouseMap(a,t){return a?BirthChartRotartion.getNewMappedCuspsAfterRotation(t||1,a):null}createStructure(a){var t=buildSVGTag("svg",new Map([["height",this.height],["width",this.width],["stroke",this.lineColor],["stroke-width",this.lineWidth],["style","border: "+this.lineWidth+"px solid "+this.lineColor+";"]]),a);return buildSVGTag("line",new Map([["x1","0"],["y1","0"],["x2",this.width],["y2",this.height]]),t),buildSVGTag("line",new Map([["x1",this.width],["y1","0"],["x2","0"],["y2",this.height]]),t),buildSVGTag("line",new Map([["x1","0"],["y1",this.height/2],["x2",this.width/2],["y2","0"]]),t),buildSVGTag("line",new Map([["x1",this.width/2],["y1",this.height],["x2",this.width],["y2",this.height/2]]),t),buildSVGTag("line",new Map([["x1",this.width/2],["y1","0"],["x2",this.width],["y2",this.height/2]]),t),buildSVGTag("line",new Map([["x1","0"],["y1",this.height/2],["x2",this.width/2],["y2",this.height]]),t),buildSVGTag("line",new Map([["x1","0"],["y1",this.height/2],["x2",this.width/2],["y2",this.height]]),t),t}fillHouseWithRasiAndPlanets(a,t,e,i){this.fillRasiInCusp(a,t,e),this.fillPlanetsInCusp(a,t,i)}fillPlanetsInCusp(a,t,e){var i;if(void 0!==e&&e.length>0){var r=placements.get(t).planet.xStartByUnit*this.widthUnit,n=placements.get(t).planet.yStartByUnit*this.heightUnit,s=placements.get(t).planet.widthInUnits*this.widthUnit,l=placements.get(t).planet.heightInUnits*this.heightUnit,o=[].concat(placements.get(t).planet.placement),d=placements.get(t).planet.textAnchor;if(i=buildSVGTag("svg",new Map([["x",r],["y",n],["width",s],["height",l]]),a),"string"==typeof e)buildSVGTag("text",new Map([["x","50%"],["y","20%"],["dominant-baseline","middle"],["text-anchor","middle"]]),i,e);else{var u=groupBy(e,"size"),c=u[4],h=u[2],p=Array(o.length).join(".").split(".");void 0!==c&&c.length>0&&this.fillText(c,2,o,p),void 0!==h&&h.length>0&&this.fillText(h,1,o,p);for(var m=0;m<p.length;m++)buildSVGTag("text",new Map([["x","middle"===d?"50%":"start"===d?"0%":"100%"],["y",100*(m+1)/(p.length+1)+"%"],["dominant-baseline","middle"],["text-anchor",d]]),i,p[m])}}return i}fillText(a,t,e,i){if(void 0!==a||a.length>0)for(const n of a)for(var r=0;r<e.length;){if(e[r]>=t){i[r]=""===i[r]?n.name:i[r]+" "+n.name,e[r]=e[r]-t;break}r++}}fillRasiInCusp(a,t,e){var i=placements.get(t).rasi.x*this.widthUnit,r=placements.get(t).rasi.y*this.heightUnit;return buildSVGTag("text",new Map([["x",i],["y",r],["class",e+"-traditional-chart-rasi-text"]]),a,e)}}class ChartDrawer{constructor(a,t,e,i){this.scope=e,this.compile=i,this.traditionalChart=new TraditionalChart(a,t)}rotateIndividualChart(a,t,e,i){var r=t+"RotatonModel";if("rasi"==a)(n=document.getElementById(t)).innerHTML="",this.traditionalChart.buildRasiChart(n,e,this.scope[r]);else if("cusp"==a){var n;(n=document.getElementById(t)).innerHTML="",this.traditionalChart.buildCuspChart(n,e,this.scope[r])}else if("divisional"==a){var s=document.getElementById(t);s.innerHTML="",this.traditionalChart.buildDivisionalChart(s,e,this.scope[r])}}buildDivisionalCharts(a,t,e,i){var r=t.divisionalCharts;if(void 0!==r&&0!==r.length){var n=buildTag("table",new Map([["class","border align-top m-0 p-0 w-100"]]),a);r.map(a=>a.chartType);e?r=r.filter(a=>e.includes(a.chartType)):i&&(r=r.filter(a=>!i.includes(a.chartType)));for(var s=Math.ceil(r.length/2),l=0;l<s;l++)for(var o=buildTag("tr",new Map([["class","m-0 p-0 w-100 overflow-auto"]]),n),d=0;d<2;d++){var u=buildTag("td",new Map([["style","border-width: 5px"],["class","border table text-center align-middle m-0 px-2 py-2 w-50"]]),o),c=2*l+d;r.length>=c+1&&this.buildChartWithRotateSelect(u,r[c],"divisional","D"+r[c].chartType,"mainDivCharts"+r[c].chartType,!0,r[c].chartType)}return this.compile(a)(this.scope),a}}buildKPCharts(a,t){var e=buildTag("table",new Map([["class","border align-top m-0 p-0 float-left w-100"]]),a),i=buildTag("tr",new Map([["class","m-0 p-0"]]),e),r=buildTag("td",new Map([["class","border w-50 h-100 m-0 p-0 align-middle"]]),i);buildRadixChart(buildTag("div",new Map([["class","rkp_chart"],["id","rkp_chart"]]),r),t);var n=buildTag("td",new Map([["class","align-top border w-50 h-100 m-0 p-0"]]),i);return this.buildBasicCharts(n,t,"mainCharts",!0),this.compile(a)(this.scope),a}buildBasicCharts(a,t,e,i,r){var n=buildTag("table",new Map([["class","m-0 p-0 w-100 h-100"]]),a),s=buildTag("tr",new Map([["class","m-0 pb-1 h-50 w-100 border-bottom"]]),n),l=buildTag("td",new Map([["class","text-center align-middle px-3 py-3"]]),s);this.buildChartWithRotateSelect(l,t,"rasi","Rasi",e+"_rasi",i);var o=buildTag("tr",new Map([["class","m-0 pt-1 h-50 w-100"]]),n),d=buildTag("td",new Map([["class","text-center align-middle px-3 py-3"]]),o);if(this.buildChartWithRotateSelect(d,t,"cusp","Cusp",e+"_cusp",i),r){var u=buildTag("tr",new Map([["class","m-0 pt-1 h-50 w-100"]]),n),c=buildTag("td",new Map([["class","text-center align-middle px-3 py-3"]]),u);this.buildChartWithRotateSelect(c,r,"divisional","D9",e+"_D9",i,9)}}buildTransitCharts(a,t,e){var i=buildTag("table",new Map([["class","border align-top m-0 p-0 float-left w-100"]]),a),r=buildTag("tr",new Map([["class","m-0 p-0"]]),i),n=buildTag("td",new Map([["class","border w-50 h-100 m-0 py-2 px-5 align-middle"]]),r),s=buildTag("div",new Map([["class","transit_rasi_chart"],["id","transit_rasi_chart"]]),n);this.buildChartWithRotateSelect(s,t,"rasi","Rasi","transit_rasi_chart_1");var l=buildTag("td",new Map([["class","border w-50 h-100 m-0 py-2 px-5 align-middle"]]),r),o=buildTag("div",new Map([["class","transit_cusp_chart"],["id","transit_cusp_chart"]]),l);this.buildChartWithRotateSelect(o,t,"cusp","Cusp","transit_cusp_chart_1");var d=buildTag("tr",new Map([["class","m-0 p-0"]]),i),u=buildTag("td",new Map([["class","border w-50 h-100 m-0 py-2 px-5 align-middle"]]),d),c=buildTag("div",new Map([["class","transit_navamsa_chart"],["id","transit_navamsa_chart"]]),u);return this.buildChartWithRotateSelect(c,e,"divisional","D9","transit_navamsa_chart_1",void 0,9),this.compile(a)(this.scope),a}buildChartWithRotateSelect(a,t,e,i,r,n,s){var l=buildTag("div",new Map([["class","d-flex justify-content-between"]]),a),o=buildTag("span",new Map([["class","pr-1"]]),l);if(buildTag("strong",new Map([["class","float-left"],["style","color:blue;"]]),o,"<u>"+i+"</u>"),n){var d=r+"RotatonModel";buildTag("select",new Map([["id",r+"RotationSelect"],["ng-options","n for n in cuspArray"],["ng-model",d],["ng-init",d+"=1"],["ng-change",'rotateIndividualChart("'+e+'", "'+r+'",'+s+")"],["class","custom-select form-control"],["required","true"]]),o)}var u=buildTag("span",new Map([["class","pr-1"]]),l),c=buildTag("div",new Map([["class","p-0"],["id",r]]),u);"rasi"==e?this.traditionalChart.buildRasiChart(c,t):"cusp"==e?this.traditionalChart.buildCuspChart(c,t):"divisional"==e&&this.traditionalChart.buildDivisionalChart(c,t)}}function buildKPCharts(a,t,e,i){var r=buildTag("table",new Map([["class","border align-top m-0 p-0 float-left w-100"]]),a),n=buildTag("tr",new Map([["class","m-0 p-0"]]),r),s=buildTag("td",new Map([["class","border w-50 h-100 m-0 p-0 align-middle"]]),n),l=buildTag("div",new Map([["class","rkp_chart"],["id","rkp_chart"]]),s),o=buildTag("td",new Map([["class","align-top border w-50 h-100 m-0 p-0"]]),n),d=buildTag("table",new Map([["class","m-0 p-0 w-100 h-100"]]),o),u=buildTag("tr",new Map([["class","m-0 pb-1 h-50 w-100 border-bottom"]]),d),c=buildTag("td",new Map([["class","text-center align-middle px-3 py-3"]]),u),h=buildTag("div",new Map([["class","d-flex justify-content-between"]]),c),p=buildTag("span",new Map([["class","pr-1"]]),h);buildTag("strong",new Map([["class","float-left"],["style","color:blue;"]]),p,"<u>Rasi</u>"),buildTag("select",new Map([["id","rasiChartRotationSelect"],["ng-options","n for n in cuspArray"],["ng-model","rasiChartRotatonModel"],["ng-init","rasiChartRotatonModel=1"],["ng-change","rotateRasiChart()"],["class","custom-select form-control"],["required","true"]]),p);var m=buildTag("span",new Map([["class","pr-1"]]),h),g=buildTag("div",new Map([["class","rasi_chart p-0"],["id","rasi_chart"]]),m),b=buildTag("tr",new Map([["class","m-0 pt-1 h-50 w-100"]]),d),y=buildTag("td",new Map([["class","text-center align-middle px-3 py-3"]]),b),C=buildTag("div",new Map([["class","d-flex justify-content-between"]]),y),v=buildTag("span",new Map([["class","pr-1"]]),C);buildTag("strong",new Map([["class","float-left"],["style","color:blue;"]]),v,"<u>Cusp</u>"),buildTag("select",new Map([["id","cuspChartRotationSelect"],["ng-options","n for n in cuspArray"],["ng-model","cuspChartRotatonModel"],["ng-init","cuspChartRotatonModel=1"],["ng-change","rotateCuspChart()"],["class","custom-select form-control"],["required","true"]]),v);var f=buildTag("span",new Map([["class","pr-1"]]),C),T=buildTag("div",new Map([["class","cusp_chart p-0"],["id","cusp_chart"]]),f);buildRadixChart(l,t);var D=new TraditionalChart(400,250);return D.buildRasiChart(g,t),D.buildCuspChart(T,t),i(a)(e),a}function buildRadixChart(a,t){var e,i=t.cuspViewModals.map(a=>a.startDegree360),r={};for(e of t.planets)r[e.planet]=[e.degree360,e.velocity];var n={planets:r,cusps:i};new astrology.Chart(a.id,550,550).radix(n).aspects()}const DEGREE_CHAR="°",MINUTE_CHAR="'",SECOND_CHAR='"';function buildTag(a,t,e,i){var r=document.createElement(a);if(void 0!==t)for(var[n,s]of t)r.setAttribute(n,s);return void 0!==i&&(r.innerHTML=i),void 0!==e&&e.appendChild(r),r}function buildSVGTag(a,t,e,i){var r=document.createElementNS("http://www.w3.org/2000/svg",a);if(void 0!==t)for(var[n,s]of t)r.setAttribute(n,s);return void 0!==i&&(r.innerHTML=i),void 0!==e&&e.appendChild(r),r}function titleCase(a){if(a){for(var t=a.toLowerCase().split(" "),e=0;e<t.length;e++)t[e]=t[e].charAt(0).toUpperCase()+t[e].slice(1);a=t.join(" ")}return a}function formatDate(a,t){var e=a.getFullYear(),i=a.getMonth()+1,r=a.getDate(),n=a.getHours(),s=a.getMinutes(),l=a.getSeconds();return e+"-"+(i>9?i:"0"+i)+"-"+(r>9?r:"0"+r)+(t||"T")+((n>9?n:"0"+n)+":"+(s>9?s:"0"+s)+":"+(l>9?l:"0"+l))}function getTZFromJhoraParams(a){var t=a>0?-1:1;a=Math.abs(a);var e=Math.floor(a);return t*(e+100*(a-e)/60)}function getDateFromJhoraParams(a){var t=a[0],e=a[1],i=a[2],r=Math.floor(a[3]),n=100*(a[3]-r),s=Math.floor(n),l=Math.floor(100*(n-s));return(l=Math.ceil(60*l/100))>=60&&(s+=1,l-=60),s>=60&&(r+=1,s-=60),i+"-"+(t>9?t:"0"+t)+"-"+(e>9?e:"0"+e)+"T"+((r>9?r:"0"+r)+":"+(s>9?s:"0"+s)+":"+(l>9?l:"0"+l))}function formatDate1(a){return a.toLocaleString("en-CA",{hour12:!1}).replace(", ","T")}function adjustForTimezone(a,t){return a.setTime(a.getTime()+1e3*t*60*60),a}function getTimeZoneHour(a){return a.getTimezoneOffset()/-60}function generateRandomInteger(a,t){return Math.floor(a+Math.random()*(t+1-a))}var getLocalLocationPositionPromise=function(a){return navigator.geolocation.getCurrentPosition(function(){},function(){},{}),new Promise(function(t,e){navigator.geolocation.getCurrentPosition(t,e,a)})};function getUntenantedSelfStarredStr(a){var t=a.unTenanted?"U":"",e=a.selfStarred?"S":"",i="";return"U"===t&&"S"===e&&(i=", "),t+i+e}function convertToDMS(a){function t(a){a=Math.abs(a);var t=Math.floor(a);a-=t,a*=60;var e=Math.floor(a);return a-=e,t+":"+e+":"+(a*=60).toFixed(2)}var e=a.longitude>0?"E":"W",i=a.latitude>0?"N":"S";return{longitude:t(a.longitude)+e,latitude:t(a.latitude)+i}}var groupBy=function(a,t){return a.reduce(function(a,e){return(a[e[t]]=a[e[t]]||[]).push(e),a},{})},groupByWithValue=function(a,t,e){return a.reduce(function(a,i){return(a[i[t]]=a[i[t]]||[]).push(i[e]),a},{})};function findByValue(a,t,e){for(var i=0;i<a.length;i++)if(a[i][t]===e)return a[i];throw"Couldn't find object with "+t+": "+e}function intArrToString(a){return a?a.join(", "):""}function convertDegreeIntoDouble(a){var t=1;(a=(a+="").toLowerCase()).startsWith("-")&&(t=-1,a=a.substring(1)),t=a.endsWith("w")||a.endsWith("s")?-1:t;var e="[: "+DEGREE_CHAR+MINUTE_CHAR+SECOND_CHAR+"news]+",i=a.split(e);return t*convertDMSIntoDouble(parseFloat(i[0]),i.length>1?parseFloat(i[1]):0,i.length>2?parseFloat(i[2]):0)%360}function convertDMSIntoDouble(a,t,e){return a+t/60+e/3600}function degreeIntoDMS(a){var t=1;a<0&&(t=-1,a*=-1);var e=a.intValue(),i=60*(a-e),r=i.intValue(),n=60*(i-r);return n>=60&&(r++,n-=60),[e,r,n,t]}const birthChartsfieldsToVlidate=["horaryNumber","name","date","longitude","latitude","timezone"],transitChartsfieldsToVlidate=["date","longitude","latitude","timezone"],citySearchfieldsToVlidate=["citySearch"];function BirthChartValidation(a,t){return this.scope=a,this.ServiceRkpChart=t,this}function isStringNullOrEmpty(a){return!a||0===(""+a).trim().length}BirthChartValidation.displayErrorMessages=function(a,t,e){for(key of(e||(e="transit"==a?transitChartsfieldsToVlidate:birthChartsfieldsToVlidate),e))t.hasOwnProperty(key)?BirthChartValidation.setInValidClass(a+key+"GrpDiv",a+key+"Input",t[key]):BirthChartValidation.setValidClass(a+key+"GrpDiv",a+key+"Input")},BirthChartValidation.validateAndDisplayMessage=function(a,t,e){e||(e="transit"==a?transitChartsfieldsToVlidate:birthChartsfieldsToVlidate);var i=BirthChartValidation.validateFields(t,e);return BirthChartValidation.displayErrorMessages(a,i,e),!(i&&Object.keys(i).length>0)},BirthChartValidation.validateFields=function(a,t){var e={};for(field of t){var i=BirthChartValidation.validateField(field,a);i&&(e[field]=i)}return 0==e.size&&(e=void 0),e},BirthChartValidation.validateField=function(a,t){var e;switch(a){case"horaryNumber":e=BirthChartValidation.validateHoraryNumber(t);break;case"name":e=BirthChartValidation.validateName(t);break;case"date":e=BirthChartValidation.validateDate(t);break;case"longitude":e=BirthChartValidation.validateLongitude(t);break;case"latitude":e=BirthChartValidation.validateLatitude(t);break;case"timezone":e=BirthChartValidation.validateTimezone(t);break;case"citySearch":e=BirthChartValidation.validateCitySearch(t)}return e},BirthChartValidation.setValidClass=function(a,t){var e=document.getElementById(t);e.classList.remove("is-valid"),e.classList.remove("is-invalid"),e.classList.add("is-valid");var i="invalid-feedback"+a,r=document.getElementById(i);r&&r.remove()},BirthChartValidation.setInValidClass=function(a,t,e){var i=document.getElementById(t);if(i.classList.remove("is-valid"),i.classList.remove("is-invalid"),i.classList.add("is-invalid"),e){var r=document.getElementById(a),n="invalid-feedback"+a,s=document.getElementById(n);s?s.innerHTML=e:buildTag("div",new Map([["id",n],["class","invalid-feedback"]]),r,e)}},BirthChartValidation.validateHoraryNumber=function(a){var t;return a.isHorayChart&&(a.horaryNumber&&a.horaryNumber>0&&a.horaryNumber<250||(t="Enter number between 1 to 249")),t},BirthChartValidation.validateName=function(a){var t;return isStringNullOrEmpty(a.name)?t="Enter Name":a.name.length>40&&(t="Name can not be more than 40 characters"),t},BirthChartValidation.validateDate=function(a){var t;return a.date instanceof Date||(t="Enter Valid Date and Time"),t},BirthChartValidation.validateLongitude=function(a){var t;return isStringNullOrEmpty(a.longitude)&&(t="Enter Valid Longitude"),t},BirthChartValidation.validateLatitude=function(a){var t;return isStringNullOrEmpty(a.latitude)&&(t="Enter Valid Latitude"),t},BirthChartValidation.validateTimezone=function(a){var t;return isStringNullOrEmpty(a.timezone)&&(t="Enter Valid Timezone"),t},BirthChartValidation.validateCitySearch=function(a){var t;return a||(t="Search city can not be blank"),t};