const ACCORDIAN_ICON_CLASS="accordian-icon";function initializeAccordians(t){var e,a=document.getElementById(t).getElementsByClassName("rkp-accordion");for(e=0;e<a.length;e++)buildAccordianTag(a[e]),a[e].addEventListener("click",function(){toggleAccordian(this)})}function buildAccordianTag(t){buildTag("span",new Map([["class","float-left px-3 "+ACCORDIAN_ICON_CLASS]]),t);var e=document.getElementById(t.getAttribute("target-id"));e.style.overflow="hidden";var a=document.getElementById(e.id+"-Outer");a&&(a.classList.add("border"),a.classList.add("border-info"),a.style.overflow="hidden");var i=t.getAttribute("target-initial-display");void 0===i||"show"!==i?(collapseAccordian(t),t.setAttribute("disabled","disabled")):expandAccordian(t)}function toggleAccordian(t,e){e||(e=document.getElementById(t.getAttribute("target-id"))),"block"===e.style.display?collapseAccordian(t,e):expandAccordian(t,e)}function expandAccordianByTargetElement(t){var e='[target-id="'+t.id+'"]';expandAccordian(document.querySelector(e),t)}function expandAccordian(t,e){var a=t.getAttribute("target-id");e||(e=document.getElementById(a));var i=t.getElementsByClassName(ACCORDIAN_ICON_CLASS);i[0].innerHTML="▼",i[0].style.color="blue",t.style.backgroundColor="LightCyan",t.removeAttribute("disabled"),e.style.display="block"}function collapseAccordianByTargetElement(t){var e='[target-id="'+t.id+'"]';collapseAccordian(document.querySelector(e),t)}function collapseAccordian(t,e){e||(e=document.getElementById(t.getAttribute("target-id")));var a=t.getElementsByClassName(ACCORDIAN_ICON_CLASS);a[0].innerHTML="►",a[0].style.color="black",t.style.backgroundColor="Lavender",e.style.display="none"}!function(){"use strict";function t(t,e){e.hashPrefix(""),t.when("/rkp-home",{templateUrl:"partials/rkp-home.html",controller:"CtrlRkpHome"}).when("/rkp-chart",{templateUrl:"partials/rkp-chart.html",controller:"CtrlRkpChart"}).otherwise({redirectTo:"/rkp-chart"})}angular.module("rkpApp",["ngRoute","rkpServiceModule","rkpControllerModule","rkpDirectiveModule"]).config(t),t.$inject=["$routeProvider","$locationProvider"]}();const basicDetailColumns=[];function buildBasicDetailDiv(t,e,a,i){for(var r=buildTag("div",new Map([["class","w-100 h-100 px-0 py-0"]]),i),n=t.basicPanchangDetail,s=Object.keys(n),l=s.length,o=buildTag("tabe",new Map([["class","table-sm w-100 h-100","m-0","p-0"]]),r),d=0;d<l;d+=4){var c="border-bottom border-left border-right";0==d&&(c="border-top "+c),c="";for(var u=buildTag("tr",new Map([["class",c+" d-flex"]]),o),h=0;h<4&&l>d+h;h++){var p=s[d+h];buildTag("td",new Map([["class","border-0 text-right col-1"]]),u,"<strong>"+p+":</strong>");"",buildTag("td",new Map([["class"," text-left col-2"]]),u,n[p])}}return i?a(i)(e):i=r,i}function BirthChartRotartion(t){return this.ascCusp=t,this}function getCuspArray(){for(var t=[],e=1;e<=12;e++)t.push(e);return t}BirthChartRotartion.cuspArray=getCuspArray(),BirthChartRotartion.getNewMappedCuspsAfterRotation=function(t,e){var a=e-t;return a<0&&(a+=12),new Map(BirthChartRotartion.cuspArray.map(t=>[t+a>12?(t+a)%12:t+a,t]))},BirthChartRotartion.prototype.rotateChartData=function(t,e){return this.mappedCuspsAfterRotation=BirthChartRotartion.getNewMappedCuspsAfterRotation(this.ascCusp,e),t.cuspViewModals.map(t=>this.mapCuspViewModalWithNewCusp(t)),t.cuspViewModals.sort((t,e)=>t.cuspNum>e.cuspNum?1:-1),t.planets.map(t=>this.mapPlanetWithNewCusp(t)),this.ascCusp=e,this.mappedCuspsAfterRotation=null,t},BirthChartRotartion.prototype.mapPlanetWithNewCusp=function(t){return t.occCusp=this.getNewCusp(t.occCusp),t.d1Rasi=this.getNewCusp(t.d1Rasi),t.d1Nak=this.getNewCusp(t.d1Nak),t.d1Sub=this.getNewCusp(t.d1Sub),t.d1SSub=this.getNewCusp(t.d1SSub),t.d2Rasi=this.getNewCusp(t.d2Rasi),t.d2Nak=this.getNewCusp(t.d2Nak),t.badhakOccCusp=this.getNewCusp(t.badhakOccCusp),t.badhakD1Rasi=this.getNewCusp(t.badhakD1Rasi),t.badhakD1Nak=this.getNewCusp(t.badhakD1Nak),t.badhakD1Sub=this.getNewCusp(t.badhakD1Sub),t.badhakD1SSub=this.getNewCusp(t.badhakD1SSub),t},BirthChartRotartion.prototype.mapCuspViewModalWithNewCusp=function(t){return t.cuspNum=this.getNewCusp(t.cuspNum),t.badhakCuspNum=this.getNewCusp(t.badhakCuspNum),t},BirthChartRotartion.prototype.getNewCusp=function(t){if(t)return Array.isArray(t)?t.map(t=>this.mappedCuspsAfterRotation.get(t)):this.mappedCuspsAfterRotation.get(t)};class ChartDataDisplayCalculation{constructor(t,e,a){this.scope=t,this.ServiceRkpChart=e,this.compile=a,this.initialData(),this.divisionalChartDrawer=new ChartDrawer(400,250,t,a)}initialData(){var t=this.ServiceRkpChart.defaultCountry,e=this.ServiceRkpChart.initialData(t);let a=this;e.then(function(e){a.ServiceRkpChart.ayanamsas=e.data.ayanamsas,a.scope.ayanamsas=a.ServiceRkpChart.ayanamsas,a.ServiceRkpChart.countries=e.data.countries,a.scope.countries=a.ServiceRkpChart.countries;var i=e.data.states;a.scope.statesCountryMap=new Map,a.scope.statesCountryMap.set(t,i),a.scope.birthChartFormFieldsstates=i,a.scope.transitstates=i})}loadStates(t){var e=this.scope[t].country;if(e){this.scope.statesCountryMap||(this.scope.statesCountryMap=new Map);var a=this.scope.statesCountryMap.get(e);if(void 0===a){var i=this.ServiceRkpChart.fetchPlaceList(e);let r=this;i.then(function(i){a=i.data,r.scope.statesCountryMap.set(e,a),r.scope[t+"states"]=a,a&&(r.scope[t].state=a[0].x)}),this.removeUnusedStates()}else this.scope[t+"states"]=a,a&&(this.scope[t].state=a[0].x);this.scope[t+"cities"]=null}}removeUnusedStates(){var t=this.scope.statesCountryMap.keys(),e=[];this.scope.birthChartFormFields&&this.scope.birthChartFormFields.country&&e.push(this.scope.birthChartFormFields.country),this.scope.transit&&this.scope.transit.country&&e.push(this.scope.transit.country);for(let a of t)e.includes(a)||this.scope.statesCountryMap.delete(a)}searchCities(t){if(!this.validateCreateChartFormData(t,this.scope[t].citySearch,["citySearch"]))return;var e=this.ServiceRkpChart.searchCities(this.scope[t].citySearch,this.scope[t].country,this.scope[t].state);let a=this;e.then(function(e){e.status>=200&&e.status<=299?(a.scope[t+"cities"]=e.data,e.data&&(a.scope[t].city=e.data[0],a.setGeoBySelectedCity(t))):a.displayBirthChartError("birthChartFormFields",e,["citySearch"])})}setGeoBySelectedCity(t){var e=this.scope[t].city;if(e){var a=convertToDMS({longitude:e.y[1],latitude:e.y[0]});this.setGeoInForm(t,a.longitude,a.latitude,e.y[2])}}initBirthChartParameter(){buildChartform(document.getElementById("birthChartFormFieldsDiv"),this.scope,this.compile,"birthChartFormFields","createRangahriChart()"),this.scope.birthChartFormFields||(this.scope.birthChartFormFields={},this.setDateAndTimeInForm("birthChartFormFields"),this.setOtherParameterInBirthChartForm("birthChartFormFields","","birth",generateRandomInteger(1,249)),this.scope.birthChartFormFields.ayanamsa=this.ServiceRkpChart.defaultAyanamsa,this.scope.birthChartFormFields.country=this.ServiceRkpChart.defaultCountry,this.scope.birthChartFormFields.state=this.ServiceRkpChart.defaultState)}initTransitParameter(){buildChartform(document.getElementById("transitFormFields"),this.scope,this.compile,"transit","getNativeTransit()"),this.scope.transit||(this.scope.transit={},this.setDateAndTimeInForm("transit"),this.scope.transit.ayanamsa=this.ServiceRkpChart.defaultAyanamsa,this.scope.transit.country=this.ServiceRkpChart.defaultCountry,this.scope.transit.state=this.ServiceRkpChart.defaultState),this.hideTransitformAyamansa()}setLocalGeoInForm(t){var e=getLocalLocationPositionPromise();let a=this;e.then(function(e){var i=convertToDMS(e.coords);a.setGeoInForm(t,i.longitude,i.latitude)});var i=getTimeZoneHour(new Date);this.scope[t].timezone=i,document.getElementById(t+"timezoneInput").value=i}setGeoInForm(t,e,a,i){this.scope[t].longitude=e,this.scope[t].latitude=a,document.getElementById(t+"longitudeInput").value=e,document.getElementById(t+"latitudeInput").value=a,i&&(this.scope[t].timezone=i,document.getElementById(t+"timezoneInput").value=i)}setDateAndTimeInForm(t,e){e||(e=new Date).setMilliseconds(0),document.getElementById(t+"dateInput").value=e,this.scope[t].date=e instanceof Date?e:new Date(e)}setBirthChartParameterFromFile(t){if(this.scope.birthParametersFile=t,this.scope.birthChartFormFields||(this.scope.birthChartFormFields={}),t){var e=t.name,a=new FileReader;a.readAsText(t,"UTF-8");let i=this;a.onload=function(t){const a=t.target.result.split(/\r\n|\n/);i.setGeoInForm("birthChartFormFields",a[2],a[3],a[1]),i.setDateAndTimeInForm("birthChartFormFields",a[0]),i.setOtherParameterInBirthChartForm("birthChartFormFields",e,a[4],a[5])},a.onerror=function(t){i.scope.fileContent="error"}}}setOtherParameterInBirthChartForm(t,e,a,i){e&&(e=e.replace(".rkp",""));var r=!(!a||"horary"!==a);document.getElementById(t+"nameInput").value=e,r?(document.getElementById(t+"birthChartRadio").getchecked=!1,document.getElementById(t+"horaryChartRadio").checked=!0):(document.getElementById(t+"birthChartRadio").checked=!0,document.getElementById(t+"horaryChartRadio").checked=!1),document.getElementById(t+"horaryNumberInput").value=i,this.scope[t].name=e,this.scope[t].isHorayChart=r,this.scope[t].horaryNumber=i}saveBirthChartFile(){var t=formatDate(this.scope.birthChartFormFields.date);t+="\n"+this.scope.birthChartFormFields.timezone,t+="\n"+this.scope.birthChartFormFields.longitude,t+="\n"+this.scope.birthChartFormFields.latitude,t+="\n"+(this.scope.birthChartFormFields.isHorayChart?"horary":"birth"),t+="\n"+this.scope.birthChartFormFields.horaryNumber;var e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),e.setAttribute("download",this.scope.birthChartFormFields.name+".rkp"),e.click()}hideTransitformAyamansa(){var t=this.ServiceRkpChart.getCachedChartData();if(t){var e=document.getElementById("transitayanamsaDiv");e&&(e.style.display="none",this.scope.transit.ayanamsa=t.nativeBirthDetail.ayanamsa)}}createBirthChart(){if(!this.validateCreateChartFormData("birthChartFormFields",this.scope.birthChartFormFields))return;var t={longitude:this.scope.birthChartFormFields.longitude,latitude:this.scope.birthChartFormFields.latitude,timezone:this.scope.birthChartFormFields.timezone,date:formatDate(this.scope.birthChartFormFields.date),name:this.scope.birthChartFormFields.name,chartType:this.scope.birthChartFormFields.isHorayChart?"horary":"birth",horaryNumber:this.scope.birthChartFormFields.horaryNumber,ayanamsa:this.scope.birthChartFormFields.ayanamsa},e=this.ServiceRkpChart.creatNewChart(t);let a=this;e.then(function(t){t.status>=200&&t.status<=299?a.displayBirthChart(t.data):a.displayBirthChartError("birthChartFormFields",t)})}createChartForTransitDiv(t){var e,a;if(t)a=new Date(this.scope.dasaTransitDT);else{if(!this.validateCreateChartFormData("transit",this.scope.transit))return;a=this.scope.transit.date,e=this.scope.transit}e=this.buildTransitRequestData(a,e),this.clearTransitData();var i=this.ServiceRkpChart.creatNewChart(e);let r=this;i.then(function(i){i.status>=200&&i.status<=299?(r.ServiceRkpChart.setTransitData(i.data),r.clearTransitData(),r.fillTransitDiv(),t&&(r.scope.transit.date=a,r.scope.transit.timezone=e.timezone,r.scope.transit.longitude=e.longitude,r.scope.transit.latitude=e.latitude)):r.displayBirthChartError("transit",i)})}fillDasaTransitDiv(t){if(this.scope.dasaTransitDT&&document.getElementById("dasa_trasit_data-planets")&&this.scope.dasaTransitDT==t)return;var e=this.buildTransitRequestData(new Date(t)),a=this.ServiceRkpChart.creatNewChart(e);let i=this;a.then(function(e){i.clearDasaTransitData(),i.scope.dasaTransitDT=t,i.fillTransitPlanetDiv(document.getElementById("dasa_trasit_data"),e.data)})}validateCreateChartFormData(t,e,a){return BirthChartValidation.validateAndDisplayMessage(t,e,a)}displayBirthChart(t){this.ServiceRkpChart.setChartData(t),this.clearHoroscopeData(),this.fillHoroscopeData()}displayBirthChartError(t,e,a){if(422==e.status){var i=e.data.fieldErrors;BirthChartValidation.displayErrorMessages(t,i,a)}else e.status=400}buildTransitRequestData(t,e){var a,i=this.ServiceRkpChart.getCachedChartData();if(t&&(e||i))return i&&(a=i.cuspViewModals.map(function(t){return t.degree360}),e||(e=i.nativeBirthDetail)),{longitude:e.longitude,latitude:e.latitude,timezone:e.timezone,date:formatDate(t),name:"transit",chartType:"transit",ayanamsa:e.ayanamsa,cuspDegrees:a}}fillHoroscopeData(){var t=document.getElementById("birthChartFormDiv");this.ServiceRkpChart.getCachedChartData()?(this.fillBasicBirthChartDetailDiv(),this.fillCompleteChartRotationDiv(),this.fillBirthChartDiv(),this.fillDivisionalChartDiv(),this.fillDasaDiv(),collapseAccordianByTargetElement(t),this.hideTransitformAyamansa()):expandAccordianByTargetElement(t)}fillBasicBirthChartDetailDiv(){var t=document.getElementById("birthChartPanchangDetailDiv");buildBasicDetailDiv(this.ServiceRkpChart.getCachedChartData(),this.scope,this.compile,t)}clearBasicBirthChartDetailDiv(){document.getElementById("birthChartPanchangDetailDiv").innerHTML=""}fillCompleteChartRotationDiv(){this.ServiceRkpChart.birthChartRotartion=new BirthChartRotartion(1),this.scope.cuspArray=BirthChartRotartion.cuspArray,this.scope.birthChartAscCusp=this.ServiceRkpChart.birthChartRotartion.ascCusp,buildChartRoationDiv(document.getElementById("birthChartRotationDiv"),this.scope,this.compile,"birthChart")}fillBirthChartDiv(){var t=this.ServiceRkpChart.getCachedChartData();if(t){this.scope.horoscopeCreated=!0,expandAccordianByTargetElement(document.getElementById("rkp_charts"));var e=document.getElementById("planet_data");expandAccordianByTargetElement(e),new PlanetTable(this.scope,this.ServiceRkpChart).build(e,t.planets);var a=document.getElementById("cusps_data");expandAccordianByTargetElement(a),new CuspTable(this.scope,this.ServiceRkpChart).build(a,t.cuspViewModals),collapseAccordianByTargetElement(a);var i=document.getElementById("dmatrix_data");expandAccordianByTargetElement(i),buildDestinyMatrixTable(i,t.planets);var r=document.getElementById("kp_charts");expandAccordianByTargetElement(r),buildKPCharts(r,t,this.scope,this.compile)}}fillDivisionalChartDiv(){var t=this.ServiceRkpChart.getCachedChartData();if(t){var e=document.getElementById("divisional_charts");expandAccordianByTargetElement(e),this.divisionalChartDrawer.buildDivisionalCharts(e,t)}}fillDasaDiv(){var t=this.ServiceRkpChart.getCachedChartData();t&&(expandAccordianByTargetElement(document.getElementById("birthChartDasa")),buildMahaDasaTabulator(document.getElementById("mahadasas_data"),t.planets))}fillTransitDiv(){var t=this.ServiceRkpChart.getCachedChartData(),e=this.ServiceRkpChart.getCachedTransitData(),a=document.getElementById("transitChartFormDiv");if(e){expandAccordianByTargetElement(document.getElementById("transitChart"));var i=document.getElementById("transit_planet_data");if(expandAccordianByTargetElement(i),this.fillTransitPlanetDiv(i,e),t){var r=document.getElementById("transit_dmatrix");expandAccordianByTargetElement(r),buildTransitDestinyMatrixTable(r,t.planets,e.planets)}collapseAccordianByTargetElement(a)}else expandAccordianByTargetElement(a)}fillTransitPlanetDiv(t,e){var a=new PlanetTable(this.scope,this.ServiceRkpChart).build(t,e.planets);a.hideColumn("d1Rasi"),a.hideColumn("d1Nak"),a.hideColumn("d1Sub"),a.hideColumn("d1SSub"),a.hideColumn("d2Nak"),a.hideColumn("d2Rasi"),a.hideColumn("badhakOccCusp"),a.hideColumn("badhakD1Rasi"),a.hideColumn("badhakD1Nak"),a.hideColumn("badhakD1Sub"),a.hideColumn("badhakD1SSub")}fillDetailedInternalDasaDiv(t,e,a){if(this.scope.currentInternalDasaStartDT&&document.getElementById("internaldasas_data-detailedDasa")&&this.scope.currentInternalDasaStartDT==e)return;var i=this.ServiceRkpChart.getDetailedDasa(t,e,a);let r=this;i.then(function(t){document.getElementById("internaldasas_data").innerHTML="",buildDetailedDasaTable(document.getElementById("internaldasas_data"),t.data[0]),r.scope.currentInternalDasaStartDT=e})}clearHoroscopeData(){this.clearBasicBirthChartDetailDiv(),this.clearChartRotationDiv(),this.clearBirthChartDiv(),this.clearDivisionalChartDiv(),this.clearDasaDiv(),this.clearTransitData(),this.ServiceRkpChart.setTransitData(null),expandAccordianByTargetElement(document.getElementById("birthChartFormDiv"))}clearChartRotationDiv(){this.ServiceRkpChart.birthChartRotartion=null,document.getElementById("birthChartRotationDiv").innerHTML=""}clearBirthChartDiv(){var t=document.getElementById("planet_data"),e=document.getElementById("cusps_data"),a=document.getElementById("dmatrix_data"),i=document.getElementById("kp_charts");t.innerHTML="",e.innerHTML="",a.innerHTML="",i.innerHTML="",collapseAccordianByTargetElement(t),collapseAccordianByTargetElement(e),collapseAccordianByTargetElement(a),collapseAccordianByTargetElement(i),collapseAccordianByTargetElement(document.getElementById("rkp_charts"))}clearDivisionalChartDiv(){var t=document.getElementById("divisional_charts");t.innerHTML="",collapseAccordianByTargetElement(t)}clearDasaDiv(){document.getElementById("mahadasas_data").innerHTML="",document.getElementById("internaldasas_data").innerHTML="",this.clearDasaTransitData(),collapseAccordianByTargetElement(document.getElementById("birthChartDasa"))}clearDasaTransitData(){this.scope.dasaTransitDT=null,document.getElementById("dasa_trasit_data").innerHTML=""}clearTransitData(){var t=document.getElementById("transit_dmatrix");collapseAccordianByTargetElement(t),t.innerHTML="";var e=document.getElementById("transit_planet_data");collapseAccordianByTargetElement(e),e.innerHTML="",expandAccordianByTargetElement(document.getElementById("transitChartFormDiv"))}resetValue(t,e){if(t&&e)for(var a=0;a<e.length;a++)if("horaryNumber"===e[a]){var i=generateRandomInteger(1,249);document.getElementById(t+"horaryNumberInput").value=i,this.scope[t].horaryNumber=i}else"geoCordinates"===e[a]?this.setLocalGeoInForm(t):"dateTime"===e[a]&&this.setDateAndTimeInForm(t)}birthChartRotate(){this.ServiceRkpChart.birthChartRotartion.ascCusp!==this.scope.birthChartAscCusp&&(this.ServiceRkpChart.birthChartRotartion.rotateChartData(this.ServiceRkpChart.getCachedChartData(),this.scope.birthChartAscCusp),this.clearBirthChartDiv(),this.clearTransitData(),this.clearDasaTransitData(),this.ServiceRkpChart.setTransitData(null),this.fillBirthChartDiv(),collapseAccordianByTargetElement(document.getElementById("divisional_charts")),console.log(this.scope.birthChartAscCusp))}rotateDivisionalChart(t){this.divisionalChartDrawer.rotateDivisionalChart(t,this.ServiceRkpChart.getCachedChartData())}}function buildChartform(t,e,a,i,r){t&&t.classList.add("pt-2");var n=buildTag("form",new Map([["class","needs-validation"]]),t),s=buildTag("div",new Map([["class","col-md-10 border py-2"]]),n),l=buildTag("div",new Map([["class","form-row pb-3 m-0"]]),s),o=buildTag("div",new Map([["id",i+"ayanamsaDiv"],["class","col-md-4"]]),l);if(buildTag("label",new Map([["for",i+"ayanamsaSelect"],["class","p-0 m-0 requiredFieldLabel"]]),o,"Ayanamsa"),buildTag("select",new Map([["id",i+"ayanamsaSelect"],["ng-options","o for o in ayanamsas"],["ng-model",i+".ayanamsa"],["class","custom-select form-control"]]),o),"birthChartFormFields"===i){var d=buildTag("div",new Map([["id",i+"chartTypeDiv"],["class","col-md-4 px-3"]]),l);buildTag("legend",new Map([["class","col-form-label p-0 m-0 requiredFieldLabel"]]),d,"Chart Type");var c=buildTag("div",new Map([["class","form-check"]]),d);buildTag("input",new Map([["id",i+"birthChartRadio"],["type","radio"],["class","form-check-input"],["ng-model",i+".isHorayChart"],["ng-value",!1]]),c),buildTag("label",new Map([["for",i+"birthChartRadio"],["class","form-check-label"]]),c,"Birth Chart");var u=buildTag("div",new Map([["class","form-check"]]),d);buildTag("input",new Map([["id",i+"horaryChartRadio"],["type","radio"],["class","form-check-input"],["ng-model",i+".isHorayChart"],["ng-value",!0]]),u),buildTag("label",new Map([["for",i+"horaryChartRadio"],["class","form-check-label"]]),u,"Horary Chart");var h=buildTag("div",new Map([["ng-show",i+".isHorayChart"],["class","col-md-4"]]),l);buildTag("label",new Map([["for",i+"horaryNumberInput"],["class","p-0 m-0 requiredFieldLabel"]]),h,"Horary Number");var p=buildTag("div",new Map([["id",i+"horaryNumberGrpDiv"],["class","input-group"]]),h);buildTag("input",new Map([["type","number"],["id",i+"horaryNumberInput"],["class","form-control"],["ng-model",i+".horaryNumber"],["min","1"],["max","249"]]),p);var m=buildTag("div",new Map([["class","input-group-append"]]),p);buildTag("button",new Map([["type","submit"],["ng-click",'resetValue("'+i+'", ["horaryNumber"])'],["class","btn btn-secondary btn-sm"]]),m,"Reset")}var g=buildTag("div",new Map([["class","form-row pb-3 m-0"]]),s);if("birthChartFormFields"===i){var b=buildTag("div",new Map([["id",i+"nameGrpDiv"],["class","col-md-6"]]),g);buildTag("label",new Map([["for",i+"nameInput"],["class","p-0 m-0 requiredFieldLabel"]]),b,"Name"),buildTag("input",new Map([["type","text"],["id",i+"nameInput"],["class","form-control"],["ng-model",i+".name"],["placeholder","Enter Name"]]),b)}var C=buildTag("div",new Map([["id",i+"dateGrpDiv"],["class","col-md-6"]]),g);buildTag("label",new Map([["for",i+"DateInput"],["class","p-0 m-0 requiredFieldLabel"]]),C,"Birth Date");var f=buildTag("div",new Map([["class","input-group"]]),C);buildTag("input",new Map([["type","datetime-local"],["id",i+"dateInput"],["step","1"],["ng-model",i+".date"],["class","form-control"]]),f);var v=buildTag("div",new Map([["class","input-group-append"]]),f);buildTag("button",new Map([["type","submit"],["ng-click",'resetValue("'+i+'", ["dateTime"])'],["class","btn btn-secondary btn-sm"]]),v,"Current");var y=buildTag("div",new Map([["class","form-row pb-3 m-0"]]),s),T=buildTag("div",new Map([["class","col-md-6"]]),y);buildTag("label",new Map([["for",i+"Country"],["class","p-0 m-0"]]),T,"Country"),buildTag("select",new Map([["id",i+"Country"],["ng-options","obj.x as obj.y for obj in countries"],["ng-model",i+".country"],["ng-change",'changeStates("'+i+'")'],["class","custom-select form-control"]]),T);var D=buildTag("div",new Map([["class","col-md-6"]]),y);buildTag("label",new Map([["for",i+"State"],["class","p-0 m-0"]]),D,"State"),buildTag("select",new Map([["id",i+"State"],["ng-options","obj.x as obj.y for obj in "+i+"states"],["ng-model",i+".state"],["class","custom-select form-control"]]),D);var w=buildTag("div",new Map([["class","form-row pb-3 m-0"]]),s),S=buildTag("div",new Map([["class","col-md-6"]]),w);buildTag("label",new Map([["for",i+"citySearch"],["class","p-0 m-0"]]),S,"Search City");var M=buildTag("div",new Map([["id",i+"citySearchGrpDiv"],["class","input-group"]]),S);buildTag("input",new Map([["type","text"],["id",i+"citySearchInput"],["ng-model",i+".citySearch"],["class","form-control"],["aria-describedby",i+"GeoHelpTextBlock"]]),M),buildTag("small",new Map([["id",i+"GeoHelpTextBlock"],["class","form-text text-info m-0 p-0"]]),S,"* Search and select city to populate geo coordinates & timezone");var B=buildTag("div",new Map([["class","input-group-append"]]),M);buildTag("button",new Map([["type","submit"],["ng-click",'searchCities("'+i+'")'],["class","btn btn-secondary btn-sm"]]),B,"Search");var k=buildTag("div",new Map([["class","col-md-6"]]),w);buildTag("label",new Map([["for",i+"City"],["class","p-0 m-0"]]),k,"Select City"),buildTag("select",new Map([["id",i+"City"],["ng-options","obj as obj.x for obj in "+i+"cities"],["ng-model",i+".city"],["ng-change",'setGeoBySelectedCity("'+i+'")'],["class","custom-select form-control"]]),k);var R=buildTag("div",new Map([["class","px-0 col-md-12"]]),s);buildTag("label",new Map([["for",i+"GeoBlock"],["class","p-0 m-0"]]),R,"Geo Coordinates & Timezone");var x=buildTag("div",new Map([["for",i+"GeoBlock"],["class","border pt-2 pb-0 m-0 px-3"]]),R),F=buildTag("div",new Map([["class","form-row p-0 m-0"]]),x),E=buildTag("div",new Map([["class","form-group col-md-12 py-0 my-0"]]),F);buildTag("button",new Map([["type","submit"],["id",i+"localGeoResetButton"],["ng-click",'resetValue("'+i+'", ["geoCordinates"])'],["class","btn btn-secondary btn-sm float-right"],["data-toggle","tooltip"],["data-placement","left"],["title","* Click to set the local geo coordinates and timezone"]]),E,"Local Geo & Timezone");var I=buildTag("div",new Map([["class","form-row p-0 m-0"]]),x),A=buildTag("div",new Map([["id",i+"longitudeGrpDiv"],["class","col-md-4"]]),I);buildTag("label",new Map([["for",i+"longInput"],["class","p-0 m-0 requiredFieldLabel"]]),A,"Longitude"),buildTag("input",new Map([["type","text"],["id",i+"longitudeInput"],["ng-model",i+".longitude"],["class","form-control"]]),A);var N=buildTag("div",new Map([["id",i+"latitudeGrpDiv"],["class","form-group col-md-4"]]),I);buildTag("label",new Map([["for",i+"latiInput"],["class","p-0 m-0 requiredFieldLabel"]]),N,"Latitude"),buildTag("input",new Map([["type","text"],["id",i+"latitudeInput"],["ng-model",i+".latitude"],["class","form-control"]]),N);var V=buildTag("div",new Map([["id",i+"timezoneGrpDiv"],["class","form-group col-md-4"]]),I);buildTag("label",new Map([["for",i+"tzInput"],["class","p-0 m-0 requiredFieldLabel"]]),V,"Timezone"),buildTag("input",new Map([["type","text"],["id",i+"timezoneInput"],["ng-model",i+".timezone"],["class","form-control"]]),V);var P=buildTag("div",new Map([["class","form-row pt-2"]]),n),H=buildTag("div",new Map([["class","form-group  px-2"]]),P);return buildTag("button",new Map([["type","submit"],["ng-click",r],["class","btn btn-success btn-lg"]]),H,"Create"),a(t)(e),t}function buildChartRoationDiv(t,e,a,i){var r=buildTag("div",new Map([["class","w-100 px-2 py-1"]]),t),n=buildTag("div",new Map([["class","w-100"],["id",i+"cuspRotationDiv"]]),r),s=buildTag("div",new Map([["class","form-row form-inline px-1"]]),n);buildTag("strong",new Map([["class","pr-5 pl-2"]]),s,"Horoscope Rotation : "),buildTag("label",new Map([["for",i+"cuspRotationSelect"],["class","px-1"]]),s,"Lagna(Ascendent Cusp): "),buildTag("select",new Map([["id",i+"cuspRotationSelect"],["ng-options","n for n in cuspArray"],["ng-model",i+"AscCusp"],["class","custom-select form-control"]]),s);var l=buildTag("div",new Map([["class","form-group  px-2"]]),s);return buildTag("button",new Map([["type","submit"],["ng-click",i+"Rotate()"],["class","btn btn-secondary"]]),l,"Go"),a(t)(e),t}var contextPath="http://ec2-3-16-82-20.us-east-2.compute.amazonaws.com:8080";const defaultCountry="IN";function ConrollerHelper(t,e,a){return this.scope=t,this.ServiceRkpChart=e,this.compile=a,this}function CuspTable(t,e){return this.scope=t,this.ServiceRkpChart=e,that=this,this}function buildMahaDasaTabulator(t,e){return new Tabulator(t,{layout:"fitData",headerSort:!1,resizableColumns:!1,movableRows:!1,movableColumns:!1,data:e,autoResize:!0,height:"570",columnMinWidth:120,columnMaxWidth:120,initialSort:[{column:"dasa.startDT",dir:"asc"}],columns:[{title:"Maha Dasa",field:"dasa.startDT",formatter:function(t,e){return buildDasaButton(t.getRow().getData())}}]})}ConrollerHelper.prototype.bindChartDataDisplayCalls=function(t){this.bindBirthChartCalls(t),this.bindDasaCalls(t),this.bindTransitChartCalls(t)},ConrollerHelper.prototype.bindBirthChartCalls=function(t){t.initBirthChartParameter(),t.fillHoroscopeData(),this.scope.resetValue=function(e,a){t.resetValue(e,a)},this.scope.birthChartRotate=function(){t.birthChartRotate()},this.scope.readBirthChartParametersFile=function(e){t.setBirthChartParameterFromFile(e)},this.scope.createRangahriChart=function(){t.createBirthChart()},this.scope.saveBirthChartRkpFile=function(){setTimeout(function(){t.saveBirthChartFile()},500)},this.scope.changeStates=function(e){t.loadStates(e)},this.scope.searchCities=function(e){t.searchCities(e)},this.scope.setGeoBySelectedCity=function(e){t.setGeoBySelectedCity(e)},this.scope.rotateDivChart=function(e){t.rotateDivisionalChart(e)}},ConrollerHelper.prototype.bindDasaCalls=function(t){this.scope.getDetailedInternalDasa=function(e,a,i){t.fillDetailedInternalDasaDiv(e,a,i)},this.scope.getDasaTransitData=function(e){t.fillDasaTransitDiv(e)}},ConrollerHelper.prototype.bindTransitChartCalls=function(t){t.initTransitParameter(),t.fillTransitDiv(),this.scope.getNativeTransit=function(){t.createChartForTransitDiv(!1)},this.scope.getNativeTransitFromDasa=function(){t.createChartForTransitDiv(!0)}},function(){"use strict";function t(t,e,a,i,r,n){var s=new ChartDataDisplayCalculation(e,i,n);new ConrollerHelper(e,i,n).bindChartDataDisplayCalls(s)}angular.module("rkpControllerModule",[]).controller("CtrlRkpChart",t).controller("CtrlRkpHome",function(t,e,a,i,r){}),t.$inject=["$http","$scope","$log","ServiceRkpChart","$q","$compile"]}(),CuspTable.prototype.transposeData=function(t){var e=[];for(row of["cuspNum","sl","cuspPercentLength","cuspRasisHtml","cuspNaksHtml","ssl","badhakCuspNum"]){var a={};a._0=row;for(var i=0;i<t.length;i++)a["_"+(i+1)]=t[i][row];e.push(a)}return console.log(e),e},CuspTable.prototype.buildTranspose=function(t,e){var a=this.transposeData(e),i=new Tabulator(t,{layout:"fitData",resizableColumns:!1,columnVertAlign:"middle",movableRows:!0,movableColumns:!0,data:a,autoResize:!0,columns:[{title:"*",field:"_0",formatter:function(t,e){return t.getValue()}},{title:"1",field:"_1",formatter:function(t,e){return t.getValue()}},{title:"2",field:"_2",formatter:function(t,e){return t.getValue()}},{title:"3",field:"_3",formatter:function(t,e){return t.getValue()}},{title:"4",field:"_4",formatter:function(t,e){return t.getValue()}},{title:"5",field:"_5",formatter:function(t,e){return t.getValue()}},{title:"6",field:"_6",formatter:function(t,e){return t.getValue()}},{title:"7",field:"_7",formatter:function(t,e){return t.getValue()}},{title:"8",field:"_8",formatter:function(t,e){return t.getValue()}},{title:"9",field:"_9",formatter:function(t,e){return t.getValue()}},{title:"10",field:"_10",formatter:function(t,e){return t.getValue()}},{title:"11",field:"_11",formatter:function(t,e){return t.getValue()}},{title:"12",field:"_12",formatter:function(t,e){return t.getValue()}}]});return t.getElementsByClassName("tabulator-header")[0].style.height=0,i},CuspTable.prototype.build=function(t,e){return new Tabulator(t,{layout:"fitData",resizableColumns:!1,columnVertAlign:"middle",movableRows:!0,movableColumns:!0,data:e,autoResize:!0,height:"935",columns:[{title:"*",field:"cuspNum",align:"right",formatter:function(t,e){return"<span style='color:red; font-weight:bold;'>"+t.getValue()+"</span>"}},{title:"SL",field:"sl",align:"center",formatter:function(t,e){return"<span style='color:red; font-weight:bold;'>"+t.getValue()+"</span>"}},{title:"%",field:"cuspPercentLength",align:"right"},{title:"Rasi",field:"cuspRasisHtml",align:"left",formatter:function(t,e){return t.getValue()}},{title:"Nakshatra",field:"cuspNaksHtml",align:"left",formatter:function(t,e){return t.getValue()}},{title:"SS",field:"ssl",align:"center"},{title:"BC",field:"badhakCuspNum",align:"right"}]})};var buildDasaButton=function(t){var e=t.dasa,a=document.createElement("button");a.id="maha-dasa-"+e.planet_number,a.innerHTML="<strong>"+e.startDT.substring(0,4)+" - "+e.endDT.substring(0,4)+"</strong>",a.classList.add("btn","btn-outline-primary","btn-sm"),a.onclick=function(t){buildDetailedDasa(t,e)};var i=document.createElement("span");return i.appendChild(document.createTextNode(e.name)),i.classList.add("dmatrix-planet-fullname-class"),i.appendChild(document.createElement("BR")),i.appendChild(a),i};function buildDetailedDasa(t,e){var a=t.currentTarget.id;angular.element(document.getElementById(a)).scope().getDetailedInternalDasa(e.planet_number,e.startDT,e.passed_years)}function buildDetailedDasaTable(t,e){var a=buildTag("div",new Map([["id",t.id+"-detailedDasa"]]),t),i=new Tabulator(a,{layout:"fitData",headerSort:!1,resizableColumns:!1,columnVertAlign:"middle",movableRows:!1,movableColumns:!1,data:e.internalDasa,dataTree:!0,dataTreeStartExpanded:!1,dataTreeChildField:"internalDasa",autoResize:!0,height:"570",columnMinWidth:75,columnMaxWidth:100,columns:[{title:e.name,formatter:function(t,e){return t.getRow().getData().name.substring(0,2)}},{title:"From: "+e.startDT.substring(0,10),formatter:function(t,e){var a=t.getRow().getData();return buildDasaTransitLink(a.startDT.substring(0,19))}},{title:"To: "+e.endDT.substring(0,10),formatter:function(t,e){return t.getRow().getData().endDT.substring(0,19)}}]});return t.appendChild(a),i}var buildDasaTransitLink=function(t){var e=Math.random().toString(36).substr(2,9)+t,a=buildTag("button",new Map([["id",e],["class","btn btn-link btn-sm"]]),void 0,t);return a.onclick=function(e){buildDasaTransitData(e,t)},a};function buildDasaTransitData(t,e){var a=t.currentTarget.id;angular.element(document.getElementById(a)).scope().getDasaTransitData(e)}function buildTransitDestinyMatrixTable(t,e,a){for(var i=new Map(a.map(t=>[t.abbr,t])),r=0;r<9;r++){var n=i.get(e[r].abbr);n.d1Rasi=e[r].d1Rasi,n.d1Nak=e[r].d1Nak,n.d1Sub=e[r].d1Sub,n.d1SSub=e[r].d1SSub}var s=[[a[0],a[1],a[2]],[a[3],a[4],a[5]],[a[6],a[7],a[8]]],l=buildTag("div",new Map([["class","px-1 py-1"]]),t),o=buildTag("table",new Map([["class","dmatrix-table table-sm m-0 p-0"]]),l);buildHorizontalHeader(o);for(r=0;r<3;r++)buildDestinyMatrixSet(r,o,i,s[r],!0)}function buildDestinyMatrixTable(t,e){var a=new Map(e.map(t=>[t.abbr,t])),i=[[e[0],e[1],e[2]],[e[3],e[4],e[5]],[e[6],e[7],e[8]]],r=buildTag("div",new Map([["class","px-1 py-1"]]),t),n=buildTag("table",new Map([["class","dmatrix-table table-sm m-0 p-0"]]),r);buildHorizontalHeader(n);for(var s=0;s<3;s++)buildDestinyMatrixSet(s,n,a,i[s],!1)}function buildDestinyMatrixSet(t,e,a,i,r){return buildOneCompleteRow(t,"first",i,a,null,null,"PL",e,r),buildOneCompleteRow(t,"m-1",i,a,"nl",null,"NL",e,r),buildOneCompleteRow(t,"m-2",i,a,"sl",null,"SL",e,r),buildOneCompleteRow(t,"last",i,a,"sl","nl","SN",e,r),e}function buildOneCompleteRow(t,e,a,i,r,n,s,l,o){var d,c=document.createElement("tr");c.classList.add("dmatrix-rowblock-any-row-"+e),c.append(buildVerticalColumnHeader(s));for(var u=0;u<3;u++)null==r?d=a[u]:(d=i.get(a[u][r]),null!=n&&(d=i.get(d[n]))),buildOneRowForOneBlock(t,u,e,c,d,o);return"first"==e&&null==r&&(o||buildDasaCell(a,l)),l.appendChild(c),c}function buildOneRowForOneBlock(t,e,a,i,r,n){var s=buildTDWithText(r.abbr);n&&"first"==a?s.classList.add("dmatrix-planet-fullname-class"):s.classList.add("dmatrix-colblock-any-col-first"),i.appendChild(s),i.appendChild(buildTDWithText(r.occCusp)),i.appendChild(buildTDWithText(intArrToString(r.d1Rasi))),i.appendChild(buildTDWithText(intArrToString(r.d1Nak))),i.appendChild(buildTDWithText(intArrToString(r.d1Sub)));var l=buildTDWithText(intArrToString(r.d1SSub));return l.classList.add("dmatrix-colblock-any-col-last"),i.appendChild(l),i}function buildDasaCell(t,e){var a=document.createElement("tr");a.append(buildVerticalColumnHeader(""));for(var i=0;i<3;i++){var r=buildAgeTextButton(t[i]);r.colSpan="6",r.classList.add("dmatrix-colblock-any-col-last"),a.append(r)}e.appendChild(a)}function buildAgeTextButton(t){var e=t.dasa,a=buildTag("button",new Map([["id","dmatrix-dasa-"+e.planet_number],["class","btn btn-outline-secondary btn-sm disabled"]]),void 0,"<strong>Age : ("+t.ageDuringMD+")</strong>");a.onclick=function(t){buildDetailedDasa(t,e)};var i=document.createElement("td"),r=document.createElement("span");return r.innerHTML=e.name+t.retStr+"<sup style='color:red;'>"+getUntenantedSelfStarredStr(t)+"</sup> : ",i.appendChild(r),i.classList.add("dmatrix-planet-fullname-class"),i.appendChild(a),i}function buildHorizontalHeader(t){var e=document.createElement("tr");e.classList.add("dmatrix-row-header");var a=buildColumnHeaderWithText("");a.classList.add("dmatrix-colblock-header"),e.appendChild(a);for(var i=0;i<3;i++)e.appendChild(buildColumnHeaderWithText("")),e.appendChild(buildColumnHeaderWithText("C")),e.appendChild(buildColumnHeaderWithText("R")),e.appendChild(buildColumnHeaderWithText("N")),e.appendChild(buildColumnHeaderWithText("S")),(a=buildColumnHeaderWithText("SS")).classList.add("dmatrix-colblock-header"),e.appendChild(a);t.appendChild(e)}function buildVerticalColumnHeader(t){var e=buildColumnHeaderWithText(t);return e.classList.add("dmatrix-colblock-header"),e}function buildColumnHeaderWithText(t){var e=buildTDWithText(t);return e.classList.add("dmatrix-header-text"),e}function buildTDWithText(t){var e=document.createElement("td");return e.appendChild(document.createTextNode(t)),e}function PlanetTable(t,e){return this.scope=t,this.ServiceRkpChart=e,that=this,this}!function(){"use strict";angular.module("rkpDirectiveModule",[]).directive("validFile",function(){return{require:"ngModel",scope:{format:"@",upload:"&upload"},link:function(t,e,a,i){e.bind("change",function(a){t.upload({file:a.target.files[0]}),t.$apply(function(){i.$setViewValue(e.val()),i.$render()})})}}})}(),PlanetTable.prototype.build=function(t,e){var a=buildTag("div",new Map([["id",t.id+"-planets"]]),t);return new Tabulator(a,{layout:"fitData",resizableColumns:!1,autoResize:!0,data:e,movableRows:!0,movableColumns:!0,columnVertAlign:"bottom",initialSort:[{column:"dasa.endDT",dir:"asc"}],columns:[{title:"Rasi",field:"rasi",align:"left",headerVertical:!0,sortable:!0,sorter:function(t,e,a,i){return a._row.getData().degree360-i._row.getData().degree360}},{title:"Degree",field:"degree",align:"right"},{title:"Nak",field:"nakshatra",align:"right",sortable:!0,sorter:function(t,e,a,i){return a._row.getData().degree360-i._row.getData().degree360}},{title:"*",field:"name",align:"left",formatter:function(t,e){var a=t.getRow().getData();return"<span style='color:red; font-weight:bold;'>"+a.abbr+a.retStr+"<sup style='color:black;'>"+getUntenantedSelfStarredStr(a)+"</sup></span>"},sortable:!0,sorter:function(t,e,a,i){return a._row.getData().dasa.planet_number-i._row.getData().dasa.planet_number}},{title:"NL",field:"nl",align:"center"},{title:"SL",field:"sl",align:"center"},{title:"SS",field:"ssl",align:"center"},{title:"CP",field:"cp",align:"right"},{title:"C",field:"occCusp",align:"right",sortable:!0,sorter:function(t,e,a,i){return a._row.getData().occCusp===i._row.getData().occCusp?a._row.getData().cp-i._row.getData().cp:a._row.getData().occCusp-i._row.getData().occCusp}},{title:"Primary Owned Cusp(s) by:",columns:[{title:"R",field:"d1Rasi",align:"right",formatter:this.cuspDataFormatter,sorter:"array",sorterParams:{type:"min",alignEmptyValues:"top"}},{title:"N",field:"d1Nak",align:"right",formatter:this.cuspDataFormatter,sorter:"array",sorterParams:{type:"min",alignEmptyValues:"top"}},{title:"S",field:"d1Sub",align:"right",formatter:this.cuspDataFormatter,sorter:"array",sorterParams:{type:"min",alignEmptyValues:"top"}},{title:"SS",field:"d1SSub",align:"right",formatter:this.cuspDataFormatter,sorter:"array",sorterParams:{type:"min",alignEmptyValues:"top"}}]},{title:"S Own Cusp",columns:[{title:"N",field:"d2Nak",align:"right",formatter:this.cuspDataFormatter,sorter:"array",sorterParams:{type:"min",alignEmptyValues:"top"}},{title:"R",field:"d2Rasi",align:"right",formatter:this.cuspDataFormatter,sorter:"array",sorterParams:{type:"min",alignEmptyValues:"top"}}]},{title:"Badhak Cusp(s) by:",columns:[{title:"C",field:"badhakOccCusp",align:"right",formatter:this.cuspDataFormatter},{title:"R",field:"badhakD1Rasi",align:"right",formatter:this.cuspDataFormatter,sorter:"array",sorterParams:{type:"min",alignEmptyValues:"top"}},{title:"N",field:"badhakD1Nak",align:"right",formatter:this.cuspDataFormatter,sorter:"array",sorterParams:{type:"min",alignEmptyValues:"top"}},{title:"S",field:"badhakD1Sub",align:"right",backgroundColor:"#f00",formatter:this.cuspDataFormatter,sorter:"array",sorterParams:{type:"min",alignEmptyValues:"top"}},{title:"SS",field:"badhakD1SSub",align:"right",visible:!1,formatter:this.cuspDataFormatter,sorter:"array",sorterParams:{type:"min",alignEmptyValues:"top"}}]},{title:"360",field:"degree360",align:"right",visible:!1,headerVertical:!0,formatter:function(t,e){return t.getValue().toFixed(2)}}]})},PlanetTable.prototype.cuspDataFormatter=function(t,e){return intArrToString(t.getValue())},function(){"use strict";function t(t,e,a){var i=this;i.ayanamsas,i.chartData,i.transitData,i.birthChartRotartion,i.countries,i.defaultCountry="IN",i.defaultState="01",i.defaultAyanamsa="Krishnamurti",this.setChartData=function(t){i.chartData=t},this.setTransitData=function(t){i.transitData=t},this.creatNewChartFromFile=function(e){return t.get(contextPath+"/chart/"+e).then(function(t){return t},function(t){return t})},this.creatNewChart=function(e){return t.post(contextPath+"/chart/",e).then(function(t){return t},function(t){return t})},this.getCachedChartData=function(){return i.chartData},this.getCachedTransitData=function(){return i.transitData},this.initialData=function(){return t.get(contextPath+"/initialData?country="+i.defaultCountry).then(function(t){return t},function(t){return t})},this.fetchPlaceList=function(e){var a="";return e&&(a="/"+e),t.get(contextPath+"/place/list"+a).then(function(t){return t},function(t){return t})},this.searchCities=function(e,a,i,r){var n="/place/search/"+a+(i?"/"+i:"")+(r?"/"+r:"")+"?citySearch="+e;return t.get(contextPath+n).then(function(t){return t},function(t){return t})},this.getDetailedDasa=function(e,a,i){var r={planetNumber:e,startDateTime:a,passedYears:i};return t.post(contextPath+"/detaileddasa/",r).then(function(t){return t},function(t){return t})},e.info("ChartService is initialzied")}angular.module("rkpServiceModule",[]).service("ServiceRkpChart",t),t.$inject=["$http","$log","$q"]}();class ChartHousePlacement{rasiPlacement(t,e){return this.rasi={},this.rasi.x=t,this.rasi.y=e,this}planetPlacement(t,e,a,i,r,n){return this.planet={},this.planet.xStartByUnit=t,this.planet.yStartByUnit=e,this.planet.widthInUnits=a,this.planet.heightInUnits=i,this.planet.placement=r,this.planet.textAnchor=n,this}}const placements=new Map;placements.set(1,(new ChartHousePlacement).rasiPlacement(4,3.65).planetPlacement(2,0,4,3,[1,4,8,4],"middle")),placements.set(4,(new ChartHousePlacement).rasiPlacement(2,5.65).planetPlacement(0,2,4,3,[1,4,8,4],"middle")),placements.set(7,(new ChartHousePlacement).rasiPlacement(4,7.65).planetPlacement(2,4,4,3,[1,4,8,4],"middle")),placements.set(10,(new ChartHousePlacement).rasiPlacement(6,5.65).planetPlacement(4,2,4,3,[1,4,8,4],"middle")),placements.set(2,(new ChartHousePlacement).rasiPlacement(2,1.65).planetPlacement(.5,0,3,1.5,[6,4],"middle")),placements.set(12,(new ChartHousePlacement).rasiPlacement(6,1.65).planetPlacement(4.5,0,3,1.5,[6,4],"middle")),placements.set(6,(new ChartHousePlacement).rasiPlacement(2,6.35).planetPlacement(.5,6.5,3,1.5,[4,6],"middle")),placements.set(8,(new ChartHousePlacement).rasiPlacement(6,6.35).planetPlacement(4.5,6.5,3,1.5,[4,6],"middle")),placements.set(3,(new ChartHousePlacement).rasiPlacement(0,3.65).planetPlacement(0,.25,2,3,[1,3,4,3],"start")),placements.set(5,(new ChartHousePlacement).rasiPlacement(0,7.65).planetPlacement(0,4.25,2,3,[1,3,4,3],"start")),placements.set(9,(new ChartHousePlacement).rasiPlacement(7.65,7.65).planetPlacement(6,4.25,1.9,3,[1,2,4,2],"end")),placements.set(11,(new ChartHousePlacement).rasiPlacement(7.65,3.65).planetPlacement(6,.25,1.9,3,[1,2,4,2],"end"));class TraditionalChart{constructor(t,e){this.lineWidth=1,this.lineColor="black",this.width=t,this.height=e,this.widthUnit=this.width/8,this.heightUnit=this.height/8}buildCuspChart(t,e,a){var i=this.createStructure(t),r=groupBy(e.planets,"occCusp");for(const t of e.cuspViewModals){var n,s=r[""+t.cuspNum];if(void 0!==s){n=[];for(const t of s)n.push({size:t.retStr.length>0?4:2,name:t.abbr+""+t.retStr})}else n=void 0;this.fillHouseWithRasiAndPlanets(i,this.getHouseNoAfterRotation(t.cuspNum,a),t.cuspRisingRasi,n)}return i}buildRasiChart(t,e,a){for(var i=this.createStructure(t),r=groupBy(e.planets,"rasiNum"),n=e.cuspViewModals[0].cuspRisingRasi,s=0;s<12;s++){var l,o=n+s,d=r[o=o>12?o%12:o];if(void 0!==d){l=[];for(const t of d)l.push({size:t.retStr.length>0?4:2,name:t.abbr+""+t.retStr})}else l=void 0;this.fillHouseWithRasiAndPlanets(i,this.getHouseNoAfterRotation(s+1,a),o,l)}return i}buildDivisionalChart(t,e,a){for(var i=this.getRotatedHouseMap(a),r=this.createStructure(t),n=0;n<12;n++){var s=e.ascendentRasi+n;s=s>12?s%12:s;var l=e.rasiPlanets[s];void 0!==l&&(l=l.map(t=>({size:2,name:t}))),this.fillHouseWithRasiAndPlanets(r,i?i.get(n+1):n+1,s,l)}return void 0!==t&&t.appendChild(r),r}getRotatedHouseMap(t,e){return t?BirthChartRotartion.getNewMappedCuspsAfterRotation(e||1,t):null}getHouseNoAfterRotation(t,e){return e&&e>1&&(t=(t+=e)>12?t%12:t),t}createStructure(t){var e=buildSVGTag("svg",new Map([["height",this.height],["width",this.width],["stroke",this.lineColor],["stroke-width",this.lineWidth],["style","border: "+this.lineWidth+"px solid "+this.lineColor+";"]]),t);return buildSVGTag("line",new Map([["x1","0"],["y1","0"],["x2",this.width],["y2",this.height]]),e),buildSVGTag("line",new Map([["x1",this.width],["y1","0"],["x2","0"],["y2",this.height]]),e),buildSVGTag("line",new Map([["x1","0"],["y1",this.height/2],["x2",this.width/2],["y2","0"]]),e),buildSVGTag("line",new Map([["x1",this.width/2],["y1",this.height],["x2",this.width],["y2",this.height/2]]),e),buildSVGTag("line",new Map([["x1",this.width/2],["y1","0"],["x2",this.width],["y2",this.height/2]]),e),buildSVGTag("line",new Map([["x1","0"],["y1",this.height/2],["x2",this.width/2],["y2",this.height]]),e),buildSVGTag("line",new Map([["x1","0"],["y1",this.height/2],["x2",this.width/2],["y2",this.height]]),e),e}fillHouseWithRasiAndPlanets(t,e,a,i){this.fillRasiInCusp(t,e,a),this.fillPlanetsInCusp(t,e,i)}fillPlanetsInCusp(t,e,a){var i;if(void 0!==a&&a.length>0){var r=placements.get(e).planet.xStartByUnit*this.widthUnit,n=placements.get(e).planet.yStartByUnit*this.heightUnit,s=placements.get(e).planet.widthInUnits*this.widthUnit,l=placements.get(e).planet.heightInUnits*this.heightUnit,o=[].concat(placements.get(e).planet.placement),d=placements.get(e).planet.textAnchor;if(i=buildSVGTag("svg",new Map([["x",r],["y",n],["width",s],["height",l]]),t),"string"==typeof a)buildSVGTag("text",new Map([["x","50%"],["y","20%"],["dominant-baseline","middle"],["text-anchor","middle"]]),i,a);else{var c=groupBy(a,"size"),u=c[4],h=c[2],p=Array(o.length).join(".").split(".");void 0!==u&&u.length>0&&this.fillText(u,2,o,p),void 0!==h&&h.length>0&&this.fillText(h,1,o,p);for(var m=0;m<p.length;m++)buildSVGTag("text",new Map([["x","middle"===d?"50%":"start"===d?"0%":"100%"],["y",100*(m+1)/(p.length+1)+"%"],["dominant-baseline","middle"],["text-anchor",d]]),i,p[m])}}return i}fillText(t,e,a,i){if(void 0!==t||t.length>0)for(const n of t)for(var r=0;r<a.length;){if(a[r]>=e){i[r]=""===i[r]?n.name:i[r]+" "+n.name,a[r]=a[r]-e;break}r++}}fillRasiInCusp(t,e,a){var i=placements.get(e).rasi.x*this.widthUnit,r=placements.get(e).rasi.y*this.heightUnit;return buildSVGTag("text",new Map([["x",i],["y",r],["class",a+"-traditional-chart-rasi-text"]]),t,a)}}class ChartDrawer{constructor(t,e,a,i){this.scope=a,this.compile=i,this.traditionalChart=new TraditionalChart(t,e)}buildDivisionalCharts(t,e){var a=e.divisionalCharts;if(void 0!==a&&0!==a.length){for(var i=buildTag("table",new Map([["class","border align-top m-0 p-0 w-100"]]),t),r=Math.ceil(a.length/2),n=0;n<r;n++)for(var s=buildTag("tr",new Map([["class","m-0 p-0 w-100"]]),i),l=0;l<2;l++){var o=buildTag("td",new Map([["style","border-width: 5px"],["class","border table text-center align-middle m-0 px-2 py-2 w-50"]]),s),d=2*n+l;if(a.length>=d+1){var c=buildTag("div",new Map([["class","d-flex justify-content-between"]]),o),u=buildTag("span",new Map([["class","pr-1"]]),c);buildTag("strong",new Map([["class","float-left"],["style","color:blue;"]]),u,"<u>D"+a[d].chartType+" </u>"),buildTag("select",new Map([["id",d+"divChartRotationSelect"],["ng-options","n for n in cuspArray"],["ng-model","divChart"+d+"rotatonModel"],["ng-init","divChart"+d+"rotatonModel=1"],["ng-change",'rotateDivChart("'+d+'")'],["class","custom-select form-control"],["required","true"]]),u);var h=buildTag("div",new Map([["class","div_chart p-0"],["id","div_chart-"+d]]),c);this.traditionalChart.buildDivisionalChart(h,a[d])}}return this.compile(t)(this.scope),t}}rotateDivisionalChart(t,e){var a=e.divisionalCharts,i=document.getElementById("div_chart-"+t);i.innerHTML="",this.traditionalChart.buildDivisionalChart(i,a[t],this.scope["divChart"+t+"rotatonModel"])}}function buildKPCharts(t,e,a,i){var r=buildTag("table",new Map([["class","border align-top m-0 p-0 float-left w-100"]]),t),n=buildTag("tr",new Map([["class","m-0 p-0"]]),r),s=buildTag("td",new Map([["class","border w-50 h-100 m-0 p-0 align-middle"]]),n),l=buildTag("div",new Map([["class","rkp_chart"],["id","rkp_chart"]]),s),o=buildTag("td",new Map([["class","align-top border w-50 h-100 m-0 p-0"]]),n),d=buildTag("table",new Map([["class","m-0 p-0 w-100 h-100"]]),o),c=buildTag("tr",new Map([["class","m-0 pb-1 h-50 w-100 border-bottom"]]),d),u=buildTag("td",new Map([["class","text-center align-middle px-3 py-3"]]),c);buildTag("strong",new Map([["class","float-left"],["style","color:blue;"]]),u,"<u>Bhav Chalit:</u>");var h=buildTag("div",new Map([["class","cusp_chart p-0"],["id","cusp_chart"]]),u),p=buildTag("tr",new Map([["class","m-0 pt-1 h-50 w-100"]]),d),m=buildTag("td",new Map([["class","text-center align-middle px-3 py-3"]]),p);buildTag("strong",new Map([["class","float-left"],["style","color:blue;"]]),m,"<u>Rasi Chart:</u>");var g=buildTag("div",new Map([["class","rasi_chart p-0"],["id","rasi_chart"]]),m);buildRadixChart(l,e);var b=new TraditionalChart(400,250);return b.buildRasiChart(g,e),b.buildCuspChart(h,e),i(t)(a),t}function buildRadixChart(t,e){var a,i=e.cuspViewModals.map(t=>t.degree360),r={};for(a of e.planets)r[a.planet]=[a.degree360,a.velocity];var n={planets:r,cusps:i};new astrology.Chart(t.id,550,550).radix(n).aspects()}function buildTag(t,e,a,i){var r=document.createElement(t);if(void 0!==e)for(var[n,s]of e)r.setAttribute(n,s);return void 0!==i&&(r.innerHTML=i),void 0!==a&&a.appendChild(r),r}function buildSVGTag(t,e,a,i){var r=document.createElementNS("http://www.w3.org/2000/svg",t);if(void 0!==e)for(var[n,s]of e)r.setAttribute(n,s);return void 0!==i&&(r.innerHTML=i),void 0!==a&&a.appendChild(r),r}function titleCase(t){if(t){for(var e=t.toLowerCase().split(" "),a=0;a<e.length;a++)e[a]=e[a].charAt(0).toUpperCase()+e[a].slice(1);t=e.join(" ")}return t}function formatDate(t){var e=t.getFullYear(),a=t.getMonth()+1,i=t.getDate(),r=t.getHours(),n=t.getMinutes(),s=t.getSeconds();return e+"-"+(a>9?a:"0"+a)+"-"+(i>9?i:"0"+i)+"T"+((r>9?r:"0"+r)+":"+(n>9?n:"0"+n)+":"+(s>9?s:"0"+s))}function formatDate1(t){return t.toLocaleString("en-CA",{hour12:!1}).replace(", ","T")}function adjustForTimezone(t,e){return t.setTime(t.getTime()+1e3*e*60*60),t}function getTimeZoneHour(t){return t.getTimezoneOffset()/-60}function generateRandomInteger(t,e){return Math.floor(t+Math.random()*(e+1-t))}var getLocalLocationPositionPromise=function(t){return navigator.geolocation.getCurrentPosition(function(){},function(){},{}),new Promise(function(e,a){navigator.geolocation.getCurrentPosition(e,a,t)})};function getUntenantedSelfStarredStr(t){var e=t.unTenanted?"U":"",a=t.selfStarred?"S":"",i="";return"U"===e&&"S"===a&&(i=", "),e+i+a}function convertToDMS(t){function e(t){t=Math.abs(t);var e=Math.floor(t);t-=e,t*=60;var a=Math.floor(t);return t-=a,e+":"+a+":"+(t*=60).toFixed(2)}var a=t.longitude>0?"E":"W",i=t.latitude>0?"N":"S";return{longitude:e(t.longitude)+a,latitude:e(t.latitude)+i}}var groupBy=function(t,e){return t.reduce(function(t,a){return(t[a[e]]=t[a[e]]||[]).push(a),t},{})};function intArrToString(t){return t?t.join(", "):""}const birthChartsfieldsToVlidate=["horaryNumber","name","date","longitude","latitude","timezone"],transitChartsfieldsToVlidate=["date","longitude","latitude","timezone"],citySearchfieldsToVlidate=["citySearch"];function BirthChartValidation(t,e){return this.scope=t,this.ServiceRkpChart=e,this}function isStringNullOrEmpty(t){return!t||0===(""+t).trim().length}BirthChartValidation.displayErrorMessages=function(t,e,a){for(key of(a||(a="transit"==t?transitChartsfieldsToVlidate:birthChartsfieldsToVlidate),a))e.hasOwnProperty(key)?BirthChartValidation.setInValidClass(t+key+"GrpDiv",t+key+"Input",e[key]):BirthChartValidation.setValidClass(t+key+"GrpDiv",t+key+"Input")},BirthChartValidation.validateAndDisplayMessage=function(t,e,a){a||(a="transit"==t?transitChartsfieldsToVlidate:birthChartsfieldsToVlidate);var i=BirthChartValidation.validateFields(e,a);return BirthChartValidation.displayErrorMessages(t,i,a),!(i&&Object.keys(i).length>0)},BirthChartValidation.validateFields=function(t,e){var a={};for(field of e){var i=BirthChartValidation.validateField(field,t);i&&(a[field]=i)}return 0==a.size&&(a=void 0),a},BirthChartValidation.validateField=function(t,e){var a;switch(t){case"horaryNumber":a=BirthChartValidation.validateHoraryNumber(e);break;case"name":a=BirthChartValidation.validateName(e);break;case"date":a=BirthChartValidation.validateDate(e);break;case"longitude":a=BirthChartValidation.validateLongitude(e);break;case"latitude":a=BirthChartValidation.validateLatitude(e);break;case"timezone":a=BirthChartValidation.validateTimezone(e);break;case"citySearch":a=BirthChartValidation.validateCitySearch(e)}return a},BirthChartValidation.setValidClass=function(t,e){var a=document.getElementById(e);a.classList.remove("is-valid"),a.classList.remove("is-invalid"),a.classList.add("is-valid");var i="invalid-feedback"+t,r=document.getElementById(i);r&&r.remove()},BirthChartValidation.setInValidClass=function(t,e,a){var i=document.getElementById(e);if(i.classList.remove("is-valid"),i.classList.remove("is-invalid"),i.classList.add("is-invalid"),a){var r=document.getElementById(t),n="invalid-feedback"+t,s=document.getElementById(n);s?s.innerHTML=a:buildTag("div",new Map([["id",n],["class","invalid-feedback"]]),r,a)}},BirthChartValidation.validateHoraryNumber=function(t){var e;return t.isHorayChart&&(t.horaryNumber&&t.horaryNumber>0&&t.horaryNumber<250||(e="Enter number between 1 to 249")),e},BirthChartValidation.validateName=function(t){var e;return isStringNullOrEmpty(t.name)?e="Enter Name":t.name.length>20&&(e="Name can not be more than 20 characters"),e},BirthChartValidation.validateDate=function(t){var e;return t.date instanceof Date||(e="Enter Valid Date and Time"),e},BirthChartValidation.validateLongitude=function(t){var e;return isStringNullOrEmpty(t.longitude)&&(e="Enter Valid Longitude"),e},BirthChartValidation.validateLatitude=function(t){var e;return isStringNullOrEmpty(t.latitude)&&(e="Enter Valid Latitude"),e},BirthChartValidation.validateTimezone=function(t){var e;return isStringNullOrEmpty(t.timezone)&&(e="Enter Valid Timezone"),e},BirthChartValidation.validateCitySearch=function(t){var e;return t||(e="Search city can not be blank"),e};